<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SUSE Edge Documentation | Standalone clusters with Edge Image Builder</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Standalone clusters with Edge Image Builder"/>
<meta name="description" content="Edge Image Builder (EIB) is a tool that streamlines the process of generating Customized, Ready-to-Boot (CRB) disk images for bootstrapping machines,…"/>
<meta name="book-title" content="SUSE Edge Documentation"/>
<meta name="chapter-title" content="Chapter 3. Standalone clusters with Edge Image Builder"/>
<meta name="tracker-url" content="https://github.com/suse-edge/suse-edge.github.io/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Standalone clusters with Edge Image Builder"/>
<meta property="og:description" content="Edge Image Builder (EIB) is a tool that streamlines the pro…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Standalone clusters with Edge Image Builder"/>
<meta name="twitter:description" content="Edge Image Builder (EIB) is a tool that streamlines the pro…"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    

    "headline": "Standalone clusters with Edge Image Builder",
  
    "description": "Standalone clusters with Edge Image Builder",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="quickstart-elemental.html" title="Chapter 2. Remote host onboarding with Elemental"/><link rel="next" href="id-components-used.html" title="Part II. Components Used"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="wide offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">SUSE Edge Documentation</a><span> / </span><a class="crumb" href="id-quick-starts.html">Quick Starts</a><span> / </span><a class="crumb" href="quickstart-eib.html">Standalone clusters with Edge Image Builder</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">SUSE Edge Documentation</div><ol><li><a href="id-suse-edge-documentation.html" class=" "><span class="title-number"> </span><span class="title-name">SUSE Edge Documentation</span></a></li><li class="active"><a href="id-quick-starts.html" class="has-children you-are-here"><span class="title-number">I </span><span class="title-name">Quick Starts</span></a><ol><li><a href="quickstart-metal3.html" class=" "><span class="title-number">1 </span><span class="title-name">BMC automated deployments with Metal<sup>3</sup></span></a></li><li><a href="quickstart-elemental.html" class=" "><span class="title-number">2 </span><span class="title-name">Remote host onboarding with Elemental</span></a></li><li><a href="quickstart-eib.html" class=" you-are-here"><span class="title-number">3 </span><span class="title-name">Standalone clusters with Edge Image Builder</span></a></li></ol></li><li><a href="id-components-used.html" class="has-children "><span class="title-number">II </span><span class="title-name">Components Used</span></a><ol><li><a href="components-rancher.html" class=" "><span class="title-number">4 </span><span class="title-name">Rancher</span></a></li><li><a href="components-rancher-dashboard-extensions.html" class=" "><span class="title-number">5 </span><span class="title-name">Rancher Dashboard Extensions</span></a></li><li><a href="components-fleet.html" class=" "><span class="title-number">6 </span><span class="title-name">Fleet</span></a></li><li><a href="components-slmicro.html" class=" "><span class="title-number">7 </span><span class="title-name">SLE Micro</span></a></li><li><a href="components-metal3.html" class=" "><span class="title-number">8 </span><span class="title-name">Metal<sup>3</sup></span></a></li><li><a href="components-eib.html" class=" "><span class="title-number">9 </span><span class="title-name">Edge Image Builder</span></a></li><li><a href="components-nmc.html" class=" "><span class="title-number">10 </span><span class="title-name">Edge Networking</span></a></li><li><a href="components-elemental.html" class=" "><span class="title-number">11 </span><span class="title-name">Elemental</span></a></li><li><a href="components-akri.html" class=" "><span class="title-number">12 </span><span class="title-name">Akri</span></a></li><li><a href="components-k3s.html" class=" "><span class="title-number">13 </span><span class="title-name">K3s</span></a></li><li><a href="components-rke2.html" class=" "><span class="title-number">14 </span><span class="title-name">RKE2</span></a></li><li><a href="components-longhorn.html" class=" "><span class="title-number">15 </span><span class="title-name">Longhorn</span></a></li><li><a href="components-neuvector.html" class=" "><span class="title-number">16 </span><span class="title-name">NeuVector</span></a></li><li><a href="components-metallb.html" class=" "><span class="title-number">17 </span><span class="title-name">MetalLB</span></a></li><li><a href="components-kubevirt.html" class=" "><span class="title-number">18 </span><span class="title-name">Edge Virtualization</span></a></li><li><a href="components-system-upgrade-controller.html" class=" "><span class="title-number">19 </span><span class="title-name">System Upgrade Controller</span></a></li><li><a href="components-upgrade-controller.html" class=" "><span class="title-number">20 </span><span class="title-name">Upgrade Controller</span></a></li></ol></li><li><a href="id-how-to-guides.html" class="has-children "><span class="title-number">III </span><span class="title-name">How-To Guides</span></a><ol><li><a href="guides-metallb-k3s.html" class=" "><span class="title-number">21 </span><span class="title-name">MetalLB on K3s (using L2)</span></a></li><li><a href="guides-metallb-kubernetes.html" class=" "><span class="title-number">22 </span><span class="title-name">MetalLB in front of the Kubernetes API server</span></a></li><li><a href="id-air-gapped-deployments-with-edge-image-builder.html" class=" "><span class="title-number">23 </span><span class="title-name">Air-gapped deployments with Edge Image Builder</span></a></li></ol></li><li><a href="id-third-party-integration.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Third-Party Integration</span></a><ol><li><a href="integrations-nats.html" class=" "><span class="title-number">24 </span><span class="title-name">NATS</span></a></li><li><a href="id-nvidia-gpus-on-sle-micro.html" class=" "><span class="title-number">25 </span><span class="title-name">NVIDIA GPUs on SLE Micro</span></a></li></ol></li><li><a href="day-2-operations.html" class="has-children "><span class="title-number">V </span><span class="title-name">Day 2 Operations</span></a><ol><li><a href="day2-mgmt-cluster.html" class=" "><span class="title-number">26 </span><span class="title-name">Management Cluster</span></a></li><li><a href="day2-downstream-clusters.html" class=" "><span class="title-number">27 </span><span class="title-name">Downstream clusters</span></a></li></ol></li><li><a href="id-product-documentation.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Product Documentation</span></a><ol><li><a href="atip.html" class=" "><span class="title-number">28 </span><span class="title-name">SUSE Adaptive Telco Infrastructure Platform (ATIP)</span></a></li><li><a href="atip-architecture.html" class=" "><span class="title-number">29 </span><span class="title-name">Concept &amp; Architecture</span></a></li><li><a href="atip-requirements.html" class=" "><span class="title-number">30 </span><span class="title-name">Requirements &amp; Assumptions</span></a></li><li><a href="atip-management-cluster.html" class=" "><span class="title-number">31 </span><span class="title-name">Setting up the management cluster</span></a></li><li><a href="atip-features.html" class=" "><span class="title-number">32 </span><span class="title-name">Telco features configuration</span></a></li><li><a href="atip-automated-provisioning.html" class=" "><span class="title-number">33 </span><span class="title-name">Fully automated directed network provisioning</span></a></li><li><a href="atip-lifecycle.html" class=" "><span class="title-number">34 </span><span class="title-name">Lifecycle actions</span></a></li></ol></li><li><a href="id-appendix.html" class="has-children "><span class="title-number">VII </span><span class="title-name">Appendix</span></a><ol><li><a href="id-release-notes.html" class=" "><span class="title-number">35 </span><span class="title-name">Release Notes</span></a></li></ol></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="quickstart-eib" data-id-title="Standalone clusters with Edge Image Builder"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Standalone clusters with Edge Image Builder</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Edge Image Builder (EIB) is a tool that streamlines the process of generating Customized, Ready-to-Boot (CRB) disk images for bootstrapping machines, even in fully air-gapped scenarios. EIB is used to create deployment images for use in all three of the SUSE Edge deployment footprints, as it’s flexible enough to offer the smallest customizations, e.g. adding a user or setting the timezone, through offering a comprehensively configured image that sets up, for example, complex networking configurations, deploys multi-node Kubernetes clusters, deploys customer workloads, and registers to the centralized management platform via Rancher/Elemental and SUSE Manager. EIB runs as in a container image, making it incredibly portable across platforms and ensuring that all of the required dependencies are self-contained, having a very minimal impact on the installed packages of the system that’s being used to operate the tool.</p><p>For more information, read the Edge Image Builder Introduction (<a class="xref" href="components-eib.html" title="Chapter 9. Edge Image Builder">Chapter 9, <em>Edge Image Builder</em></a>).</p><section class="sect1" id="id-prerequisites-2" data-id-title="Prerequisites"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.1 </span><span class="title-name">Prerequisites</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#id-prerequisites-2">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>An x86_64 physical host (or virtual machine) running SLES 15 SP5, openSUSE Leap 15.5, or openSUSE Tumbleweed.</p></li><li class="listitem"><p>An available container runtime (e.g. Podman)</p></li><li class="listitem"><p>A downloaded copy of the latest SLE Micro 5.5 SelfInstall "GM2" ISO image found <a class="link" href="https://www.suse.com/download/sle-micro/" target="_blank">here</a>.</p></li></ul></div><div id="id-1.3.5.4.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>Other operating systems may function so long as a compatible container runtime is available, but testing on other platforms has not been extensive. The documentation focuses on Podman, but the same functionality should be able to be achieved with Docker.</p></div><section class="sect2" id="id-getting-the-eib-image" data-id-title="Getting the EIB Image"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.1.1 </span><span class="title-name">Getting the EIB Image</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#id-getting-the-eib-image">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The EIB container image is publicly available and can be downloaded from the SUSE Edge registry by running the following command on your image build host:</p><div class="verbatim-wrap"><pre class="screen">podman pull registry.suse.com/edge/3.1/edge-image-builder:1.1.0</pre></div></section></section><section class="sect1" id="id-creating-the-image-configuration-directory" data-id-title="Creating the image configuration directory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.2 </span><span class="title-name">Creating the image configuration directory</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#id-creating-the-image-configuration-directory">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>As EIB runs within a container, we need to mount a configuration directory from the host, enabling you to specify your desired configuration, and during the build process EIB has access to any required input files and supporting artifacts. This directory must follow a specific structure. Let’s create it, assuming that this directory will exist in your home directory, and called "eib":</p><div class="verbatim-wrap"><pre class="screen">export CONFIG_DIR=$HOME/eib
mkdir -p $CONFIG_DIR/base-images</pre></div><p>In the previous step we created a "base-images" directory that will host the SLE Micro 5.5 input image, let’s ensure that the downloaded image is copied over to the configuration directory:</p><div class="verbatim-wrap"><pre class="screen">cp /path/to/downloads/SL-Micro.x86_64-6.0-Base-SelfInstall-GM.install.iso $CONFIG_DIR/base-images/slemicro.iso</pre></div><div id="id-1.3.5.5.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>During the EIB run, the original base image is <span class="strong"><strong>not</strong></span> modified; a new and customized version is created with the desired configuration in the root of the EIB config directory.</p></div><p>The configuration directory at this point should look like the following:</p><div class="verbatim-wrap"><pre class="screen">└── base-images/
    └── slemicro.iso</pre></div></section><section class="sect1" id="quickstart-eib-definition-file" data-id-title="Creating the image definition file"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.3 </span><span class="title-name">Creating the image definition file</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#quickstart-eib-definition-file">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The definition file describes the majority of configurable options that the Edge Image Builder supports, a full example of options can be found <a class="link" href="https://github.com/suse-edge/edge-image-builder/blob/release-1.0/pkg/image/testdata/full-valid-example.yaml" target="_blank">here</a>, and we would recommend that you take a look at the <a class="link" href="https://github.com/suse-edge/edge-image-builder/blob/release-1.0/docs/building-images.md" target="_blank">upstream building images guide</a> for more comprehensive examples than the one we’re going to run through below. Let’s start with a very basic definition file for our OS image:</p><div class="verbatim-wrap"><pre class="screen">cat &lt;&lt; EOF &gt; $CONFIG_DIR/iso-definition.yaml
apiVersion: 1.0
image:
  imageType: iso
  arch: x86_64
  baseImage: slemicro.iso
  outputImageName: eib-image.iso
EOF</pre></div><p>This definition specifies that we’re generating an output image for an <code class="literal">x86_64</code> based system. The image that will be used as the base for further modification is an <code class="literal">iso</code> image named <code class="literal">slemicro.iso</code>,
expected to be located at <code class="literal">$CONFIG_DIR/base-images/slemicro.iso</code>. It also outlines that after EIB finishes modifying the image, the output image will be named <code class="literal">eib-image.iso</code>, and by default will reside in <code class="literal">$CONFIG_DIR</code>.</p><p>Now our directory structure should look like:</p><div class="verbatim-wrap"><pre class="screen">├── iso-definition.yaml
└── base-images/
    └── slemicro.iso</pre></div><p>In the following sections we’ll walk through a few examples of common operations:</p><section class="sect2" id="id-configuring-os-users" data-id-title="Configuring OS Users"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.3.1 </span><span class="title-name">Configuring OS Users</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#id-configuring-os-users">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>EIB allows you to preconfigure users with login information, such as passwords or SSH keys, including setting a fixed root password. As part of this example we’re going to fix the root password, and the first step is to use <code class="literal">OpenSSL</code> to create a one-way encrypted password:</p><div class="verbatim-wrap"><pre class="screen">openssl passwd -6 SecurePassword</pre></div><p>This will output something similar to:</p><div class="verbatim-wrap"><pre class="screen">$6$G392FCbxVgnLaFw1$Ujt00mdpJ3tDHxEg1snBU3GjujQf6f8kvopu7jiCBIhRbRvMmKUqwcmXAKggaSSKeUUOEtCP3ZUoZQY7zTXnC1</pre></div><p>We can then add a section in the definition file called <code class="literal">operatingSystem</code> with a <code class="literal">users</code> array inside it. The resulting file should look like:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">apiVersion: 1.0
image:
  imageType: iso
  arch: x86_64
  baseImage: slemicro.iso
  outputImageName: eib-image.iso
operatingSystem:
  users:
    - username: root
      encryptedPassword: $6$G392FCbxVgnLaFw1$Ujt00mdpJ3tDHxEg1snBU3GjujQf6f8kvopu7jiCBIhRbRvMmKUqwcmXAKggaSSKeUUOEtCP3ZUoZQY7zTXnC1</pre></div><div id="id-1.3.5.6.8.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>It’s also possible to add additional users, create the home directories, set user-id’s, add ssh-key authentication, and modify group information. Please refer to the <a class="link" href="https://github.com/suse-edge/edge-image-builder/blob/release-1.0/docs/building-images.md" target="_blank">upstream building images guide</a> for further examples.</p></div></section><section class="sect2" id="id-configuring-rpm-packages" data-id-title="Configuring RPM packages"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.3.2 </span><span class="title-name">Configuring RPM packages</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#id-configuring-rpm-packages">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>One of the major features of EIB is to provide a mechanism to add additional software packages to the image, so when the installation completes the system is able to leverage the installed packages right away. EIB permits users to specify the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Packages by their name within a list in the image definition</p></li><li class="listitem"><p>Network repositories to search for these packages in</p></li><li class="listitem"><p>SUSE Customer Center (SCC) credentials to search official SUSE repositories for the listed packages</p></li><li class="listitem"><p>Via an <code class="literal">$CONFIG_DIR/rpms</code> directory, side-load custom RPM’s that don’t exist in network repositories</p></li><li class="listitem"><p>Via the same directory (<code class="literal">$CONFIG_DIR/rpms/gpg-keys</code>), GPG-keys to enable validation of third party packages</p></li></ul></div><p>EIB will then run through a package resolution process at image build time, taking the base image as the input, and attempts to pull and install all supplied packages, either specified via the list or provided locally. EIB downloads all of the packages, including any dependencies into a repository that exists within the output image and instructs the system to install these during the first boot process. Doing this process during the image build guarantees that the packages will successfully install during first-boot on the desired platform, e.g. the node at the edge. This is also advantageous in environments where you want to bake the additional packages into the image rather than pull them over the network when in operation, e.g. for air-gapped or restricted network environments.</p><p>As a simple example to demonstrate this, we are going to install the <code class="literal">nvidia-container-toolkit</code> RPM package found in the third party vendor-supported NVIDIA repository:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">  packages:
    packageList:
      - nvidia-container-toolkit
    additionalRepos:
      - url: https://nvidia.github.io/libnvidia-container/stable/rpm/x86_64</pre></div><p>The resulting definition file looks like:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">apiVersion: 1.0
image:
  imageType: iso
  arch: x86_64
  baseImage: slemicro.iso
  outputImageName: eib-image.iso
operatingSystem:
  users:
    - username: root
      encryptedPassword: $6$G392FCbxVgnLaFw1$Ujt00mdpJ3tDHxEg1snBU3GjujQf6f8kvopu7jiCBIhRbRvMmKUqwcmXAKggaSSKeUUOEtCP3ZUoZQY7zTXnC1
  packages:
    packageList:
      - nvidia-container-toolkit
    additionalRepos:
      - url: https://nvidia.github.io/libnvidia-container/stable/rpm/x86_64</pre></div><p>The above is a simple example, but for completeness, download the NVIDIA package signing key before running the image generation:</p><div class="verbatim-wrap highlight bash"><pre class="screen">$ mkdir -p $CONFIG_DIR/rpms/gpg-keys
$ curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey &gt; rpms/gpg-keys/nvidia.gpg</pre></div><div id="id-1.3.5.6.9.11" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>Adding in additional RPM’s via this method is meant for the addition of supported third party components or user-supplied (and maintained) packages; this mechanism should not be used to add packages that would not usually be supported on SLE Micro. If this mechanism is used to add components from openSUSE repositories (which are not supported), including from newer releases or service packs, you may end up with an unsupported configuration, especially when dependency resolution results in core parts of the operating system being replaced, even though the resulting system may appear to function as expected. If you’re unsure, contact your SUSE representative for assistance in determining the supportability of your desired configuration.</p></div><div id="id-1.3.5.6.9.12" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>A more comprehensive guide with additional examples can be found in the <a class="link" href="https://github.com/suse-edge/edge-image-builder/blob/release-1.0/docs/installing-packages.md" target="_blank">upstream installing packages guide</a>.</p></div></section><section class="sect2" id="id-configuring-kubernetes-cluster-and-user-workloads" data-id-title="Configuring Kubernetes cluster and user workloads"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.3.3 </span><span class="title-name">Configuring Kubernetes cluster and user workloads</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#id-configuring-kubernetes-cluster-and-user-workloads">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Another feature of EIB is the ability to use it to automate the deployment of both single-node and multi-node highly-available Kubernetes clusters that "bootstrap in place", i.e. don’t require any form of centralized management infrastructure to coordinate. The primary driver behind this approach is for air-gapped deployments, or network restricted environments, but it also serves as a way of quickly bootstrapping standalone clusters, even if full and unrestricted network access is available.</p><p>This method enables not only the deployment of the customized operating system, but also the ability to specify Kubernetes configuration, any additional layered components via Helm charts, and any user workloads via supplied Kubernetes manifests. However, the design principle behind using this method is that we default to assuming that the user is wanting to air-gap and therefore any items specified in the image definition will be pulled into the image, which includes user-supplied workloads, where EIB will make sure that any discovered images that are required by definitions supplied are copied locally, and are served by the embedded image registry in the resulting deployed system.</p><p>In this next example, we’re going to take our existing image definition and will specify a Kubernetes configuration (in this example it doesn’t list the systems and their roles, so we default to assuming single-node), which will instruct EIB to provision a single-node RKE2 Kubernetes cluster. To show the automation of both the deployment of both user-supplied workloads (via manifest) and layered components (via Helm), we are going to install KubeVirt via the SUSE Edge Helm chart, as well as NGINX via a Kubernetes manifest. The additional configuration we need to append to the existing image definition is as follows:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">kubernetes:
  version: v1.30.3+rke2r1
  manifests:
    urls:
      - https://k8s.io/examples/application/nginx-app.yaml
  helm:
    charts:
      - name: kubevirt-chart
        version: 0.4.0
        repositoryName: suse-edge
    repositories:
      - name: suse-edge
        url: oci://registry.suse.com/edge/3.1</pre></div><p>The resulting full definition file should now look like:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">apiVersion: 1.0
image:
  imageType: iso
  arch: x86_64
  baseImage: slemicro.iso
  outputImageName: eib-image.iso
operatingSystem:
  users:
    - username: root
      encryptedPassword: $6$G392FCbxVgnLaFw1$Ujt00mdpJ3tDHxEg1snBU3GjujQf6f8kvopu7jiCBIhRbRvMmKUqwcmXAKggaSSKeUUOEtCP3ZUoZQY7zTXnC1
  packages:
    packageList:
      - nvidia-container-toolkit
    additionalRepos:
      - url: https://nvidia.github.io/libnvidia-container/stable/rpm/x86_64
kubernetes:
  version: v1.30.3+rke2r1
  manifests:
    urls:
      - https://k8s.io/examples/application/nginx-app.yaml
  helm:
    charts:
      - name: kubevirt-chart
        version: 0.4.0
        repositoryName: suse-edge
    repositories:
      - name: suse-edge
        url: oci://registry.suse.com/edge/3.1</pre></div><div id="id-1.3.5.6.10.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>Further examples of options such as multi-node deployments, custom networking, and Helm chart options/values can be found in the <a class="link" href="https://github.com/suse-edge/edge-image-builder/blob/release-1.0/docs/building-images.md#kubernetes" target="_blank">upstream documentation</a>.</p></div></section><section class="sect2" id="quickstart-eib-network" data-id-title="Configuring the network"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.3.4 </span><span class="title-name">Configuring the network</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#quickstart-eib-network">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>In the last example in this quickstart, let’s configure the network that will be brought up when a system is provisioned with the image generated by EIB. It’s important to understand that unless a network configuration is supplied, the default model is that DHCP will be used on all interfaces discovered at boot time. However, this is not always a desirable configuration, especially if DHCP is not available and you need to provide static configurations, or you need to set up more complex networking constructs, e.g. bonds, LACP, and VLAN’s, or need to override certain parameters, e.g. hostnames, DNS servers, and routes.</p><p>EIB provides the ability to provide either per-node configurations (where the system in question is uniquely identified by its MAC address), or an override for supplying an identical configuration to each machine, which is more useful when the system MAC addresses aren’t known. An additional tool is used by EIB called Network Manager Configurator, or <code class="literal">nmc</code> for short, which is a tool built by the SUSE Edge team to allow custom networking configurations to be applied based on the <a class="link" href="https://nmstate.io/" target="_blank">nmstate.io</a> declarative network schema, and at boot time will identify the node it’s booting on and will apply the desired network configuration prior to any services coming up.</p><p>We’ll now apply a static network configuration for a system with a single interface by describing the desired network state in a node-specific file (based on the desired hostname) in the required <code class="literal">network</code> directory:</p><div class="verbatim-wrap"><pre class="screen">mkdir $CONFIG_DIR/network

cat &lt;&lt; EOF &gt; $CONFIG_DIR/network/host1.local.yaml
routes:
  config:
  - destination: 0.0.0.0/0
    metric: 100
    next-hop-address: 192.168.122.1
    next-hop-interface: eth0
    table-id: 254
  - destination: 192.168.122.0/24
    metric: 100
    next-hop-address:
    next-hop-interface: eth0
    table-id: 254
dns-resolver:
  config:
    server:
    - 192.168.122.1
    - 8.8.8.8
interfaces:
- name: eth0
  type: ethernet
  state: up
  mac-address: 34:8A:B1:4B:16:E7
  ipv4:
    address:
    - ip: 192.168.122.50
      prefix-length: 24
    dhcp: false
    enabled: true
  ipv6:
    enabled: false
EOF</pre></div><div id="id-1.3.5.6.11.6" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>The above example is set up for the default <code class="literal">192.168.122.0/24</code> subnet assuming that testing is being executed on a virtual machine, please adapt to suit your environment, not forgetting the MAC address. As the same image can be used to provision multiple nodes, networking configured by EIB (via <code class="literal">nmc</code>) is dependent on it being able to uniquely identify the node by its MAC address, and hence during boot <code class="literal">nmc</code> will apply the correct networking configuration to each machine. This means that you’ll need to know the MAC addresses of the systems you want to install onto. Alternatively, the default behavior is to rely on DHCP, but you can utilize the <code class="literal">configure-network.sh</code> hook to apply a common configuration to all nodes - see the networking guide (<a class="xref" href="components-nmc.html" title="Chapter 10. Edge Networking">Chapter 10, <em>Edge Networking</em></a>) for further details.</p></div><p>The resulting file structure should look like:</p><div class="verbatim-wrap"><pre class="screen">├── iso-definition.yaml
├── base-images/
│   └── slemicro.iso
└── network/
    └── host1.local.yaml</pre></div><p>The network configuration we just created will be parsed and the necessary NetworkManager connection files will be automatically generated and inserted into the new installation image that EIB will create. These files will be applied during the provisioning of the host, resulting in a complete network configuration.</p><div id="id-1.3.5.6.11.10" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>Please refer to the Edge Networking component (<a class="xref" href="components-nmc.html" title="Chapter 10. Edge Networking">Chapter 10, <em>Edge Networking</em></a>) for a more comprehensive explanation of the above configuration and examples of this feature.</p></div></section></section><section class="sect1" id="id-building-the-image" data-id-title="Building the image"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.4 </span><span class="title-name">Building the image</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#id-building-the-image">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Now that we’ve got a base image and an image definition for EIB to consume, let’s go ahead and build the image. For this, we simply use <code class="literal">podman</code> to call the EIB container with the "build" command, specifying the definition file:</p><div class="verbatim-wrap highlight bash"><pre class="screen">podman run --rm -it --privileged -v $CONFIG_DIR:/eib \
registry.suse.com/edge/3.1/edge-image-builder:1.1.0 \
build --definition-file iso-definition.yaml</pre></div><p>The output of the command should be similar to:</p><div class="verbatim-wrap"><pre class="screen">Setting up Podman API listener...
Generating image customization components...
Identifier ................... [SUCCESS]
Custom Files ................. [SKIPPED]
Time ......................... [SKIPPED]
Network ...................... [SUCCESS]
Groups ....................... [SKIPPED]
Users ........................ [SUCCESS]
Proxy ........................ [SKIPPED]
Resolving package dependencies...
Rpm .......................... [SUCCESS]
Systemd ...................... [SKIPPED]
Elemental .................... [SKIPPED]
Suma ......................... [SKIPPED]
Downloading file: dl-manifest-1.yaml 100%  (498/498 B, 5.9 MB/s)
Populating Embedded Artifact Registry... 100%  (3/3, 11 it/min)
Embedded Artifact Registry ... [SUCCESS]
Keymap ....................... [SUCCESS]
Configuring Kubernetes component...
The Kubernetes CNI is not explicitly set, defaulting to 'cilium'.
Downloading file: rke2_installer.sh
Downloading file: rke2-images-core.linux-amd64.tar.zst 100% (782/782 MB, 98 MB/s)
Downloading file: rke2-images-cilium.linux-amd64.tar.zst 100% (367/367 MB, 100 MB/s)
Downloading file: rke2.linux-amd64.tar.gz 100%  (34/34 MB, 101 MB/s)
Downloading file: sha256sum-amd64.txt 100%  (3.9/3.9 kB, 1.5 MB/s)
Downloading file: dl-manifest-1.yaml 100%  (498/498 B, 7.2 MB/s)
Kubernetes ................... [SUCCESS]
Certificates ................. [SKIPPED]
Building ISO image...
Kernel Params ................ [SKIPPED]
Image build complete!</pre></div><p>The built ISO image is stored at <code class="literal">$CONFIG_DIR/eib-image.iso</code>:</p><div class="verbatim-wrap"><pre class="screen">├── iso-definition.yaml
├── eib-image.iso
├── _build
│   └── cache/
│       └── ...
│   └── build-&lt;timestamp&gt;/
│       └── ...
├── base-images/
│   └── slemicro.iso
└── network/
    └── host1.local.yaml</pre></div><p>Each build creates a time-stamped folder in <code class="literal">$CONFIG_DIR/_build/</code> that includes the logs of the build, the artifacts used during the build,
and the <code class="literal">combustion</code> and <code class="literal">artefacts</code> directories which contain all the scripts and artifacts that are added to the CRB image.</p><p>The contents of this directory should look like:</p><div class="verbatim-wrap"><pre class="screen">├── build-&lt;timestamp&gt;/
│   │── combustion/
│   │   ├── 05-configure-network.sh
│   │   ├── 10-rpm-install.sh
│   │   ├── 12-keymap-setup.sh
│   │   ├── 13b-add-users.sh
│   │   ├── 20-k8s-install.sh
│   │   ├── 26-embedded-registry.sh
│   │   ├── 48-message.sh
│   │   ├── network/
│   │   │   ├── host1.local/
│   │   │   │   └── eth0.nmconnection
│   │   │   └── host_config.yaml
│   │   ├── nmc
│   │   └── script
│   │── artefacts/
│   │   │── registry/
│   │   │   ├── hauler
│   │   │   ├── nginx:1.14.2-registry.tar.zst
│   │   │   ├── rancher_kubectl:v1.28.7-registry.tar.zst
│   │   │   └── registry.suse.com_suse_sles_15.5_virt-operator:1.1.1-150500.8.12.1-registry.tar.zst
│   │   │── rpms/
│   │   │   └── rpm-repo
│   │   │       ├── addrepo0
│   │   │       │   └── x86_64
│   │   │       │       ├── nvidia-container-toolkit-1.15.0-1.x86_64.rpm
│   │   │       │       ├── ...
│   │   │       ├── repodata
│   │   │       │   ├── ...
│   │   │       └── zypper-success
│   │   └── kubernetes/
│   │       ├── rke2_installer.sh
│   │       ├── registries.yaml
│   │       ├── server.yaml
│   │       ├── images/
│   │       │   ├── rke2-images-cilium.linux-amd64.tar.zst
│   │       │   └── rke2-images-core.linux-amd64.tar.zst
│   │       ├── install/
│   │       │   ├── rke2.linux-amd64.tar.gz
│   │       │   └── sha256sum-amd64.txt
│   │       └── manifests/
│   │           ├── dl-manifest-1.yaml
│   │           └── kubevirt-chart.yaml
│   ├── createrepo.log
│   ├── eib-build.log
│   ├── embedded-registry.log
│   ├── helm
│   │   └── kubevirt-chart
│   │       └── kubevirt-0.4.0.tgz
│   ├── helm-pull.log
│   ├── helm-template.log
│   ├── iso-build.log
│   ├── iso-build.sh
│   ├── iso-extract
│   │   └── ...
│   ├── iso-extract.log
│   ├── iso-extract.sh
│   ├── modify-raw-image.sh
│   ├── network-config.log
│   ├── podman-image-build.log
│   ├── podman-system-service.log
│   ├── prepare-resolver-base-tarball-image.log
│   ├── prepare-resolver-base-tarball-image.sh
│   ├── raw-build.log
│   ├── raw-extract
│   │   └── ...
│   └── resolver-image-build
│       └──...
└── cache
    └── ...</pre></div><p>If the build fails, <code class="literal">eib-build.log</code> is the first log that contains information. From there, it will direct you to the component that failed for debugging.</p><p>At this point, you should have a ready-to-use image that will:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Deploy SLE Micro 5.5</p></li><li class="listitem"><p>Configure the root password</p></li><li class="listitem"><p>Install the <code class="literal">nvidia-container-toolkit</code> package</p></li><li class="listitem"><p>Configure an embedded container registry to serve content locally</p></li><li class="listitem"><p>Install single-node RKE2</p></li><li class="listitem"><p>Configure static networking</p></li><li class="listitem"><p>Install KubeVirt</p></li><li class="listitem"><p>Deploy a user-supplied manifest</p></li></ol></div></section><section class="sect1" id="quickstart-eib-image-debug" data-id-title="Debugging the image build process"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.5 </span><span class="title-name">Debugging the image build process</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#quickstart-eib-image-debug">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>If the image build process fails, refer to the <a class="link" href="https://github.com/suse-edge/edge-image-builder/blob/release-1.0/docs/debugging.md" target="_blank">upstream debugging guide</a>.</p></section><section class="sect1" id="quickstart-eib-image-test" data-id-title="Testing your newly built image"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.6 </span><span class="title-name">Testing your newly built image</span></span> <a title="Permalink" class="permalink" href="quickstart-eib.html#quickstart-eib-image-test">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>For instructions on how to test the newly built CRB image, refer to the <a class="link" href="https://github.com/suse-edge/edge-image-builder/blob/release-1.0/docs/testing-guide.md" target="_blank">upstream image testing guide</a>.</p></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="quickstart-elemental.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 2 </span>Remote host onboarding with Elemental</span></a> </div><div><a class="pagination-link next" href="id-components-used.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Part II </span>Components Used</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="section"><a href="quickstart-eib.html#id-prerequisites-2"><span class="title-number">3.1 </span><span class="title-name">Prerequisites</span></a></span></li><li><span class="section"><a href="quickstart-eib.html#id-creating-the-image-configuration-directory"><span class="title-number">3.2 </span><span class="title-name">Creating the image configuration directory</span></a></span></li><li><span class="section"><a href="quickstart-eib.html#quickstart-eib-definition-file"><span class="title-number">3.3 </span><span class="title-name">Creating the image definition file</span></a></span></li><li><span class="section"><a href="quickstart-eib.html#id-building-the-image"><span class="title-number">3.4 </span><span class="title-name">Building the image</span></a></span></li><li><span class="section"><a href="quickstart-eib.html#quickstart-eib-image-debug"><span class="title-number">3.5 </span><span class="title-name">Debugging the image build process</span></a></span></li><li><span class="section"><a href="quickstart-eib.html#quickstart-eib-image-test"><span class="title-number">3.6 </span><span class="title-name">Testing your newly built image</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>