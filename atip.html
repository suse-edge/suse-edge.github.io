<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SUSE Edge Documentation | SUSE Adaptive Telco Infrastructure Platform (ATIP)</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="SUSE Adaptive Telco Infrastructure Platform (ATIP)"/>
<meta name="description" content="SUSE ATIP is a platform designed for hosting modern, cloud native, Telco applications at scale from core to edge."/>
<meta name="book-title" content="SUSE Edge Documentation"/>
<meta name="chapter-title" content="Chapter 20. SUSE Adaptive Telco Infrastructure Platform (ATIP)"/>
<meta name="tracker-url" content="https://github.com/suse-edge/suse-edge.github.io/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="SUSE Adaptive Telco Infrastructure Platform (ATIP)"/>
<meta property="og:description" content="SUSE ATIP is a platform designed for hosting modern, cloud …"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SUSE Adaptive Telco Infrastructure Platform (ATIP)"/>
<meta name="twitter:description" content="SUSE ATIP is a platform designed for hosting modern, cloud …"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
    "inLanguage": "en",
    

    "headline": "SUSE Adaptive Telco Infrastructure Platform (ATIP)",
  
    "description": "SUSE Adaptive Telco Infrastructure Platform (ATIP)",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-03-29T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="id-product-documentation.html" title="Part IV. Product Documentation"/><link rel="next" href="id-appendix.html" title="Appendix A. Appendix"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="wide offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">SUSE Edge Documentation</a><span> / </span><a class="crumb" href="id-product-documentation.html">Product Documentation</a><span> / </span><a class="crumb" href="atip.html">SUSE Adaptive Telco Infrastructure Platform (ATIP)</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">SUSE Edge Documentation</div><ol><li><a href="id-suse-edge-documentation.html" class=" "><span class="title-number"> </span><span class="title-name">SUSE Edge Documentation</span></a></li><li><a href="id-quickstarts.html" class="has-children "><span class="title-number">I </span><span class="title-name">Quickstarts</span></a><ol><li><a href="id-demolab-setups.html" class=" "><span class="title-number">1 </span><span class="title-name">Demo/Lab Setups</span></a></li><li><a href="id-standalone-clusters-with-edge-image-builder.html" class=" "><span class="title-number">2 </span><span class="title-name">Standalone Clusters with Edge Image Builder</span></a></li><li><a href="id-bmc-automated-deployments-with-metal3.html" class=" "><span class="title-number">3 </span><span class="title-name">BMC automated deployments with Metal<sup>3</sup></span></a></li><li><a href="id-remote-host-onboarding-with-elemental.html" class=" "><span class="title-number">4 </span><span class="title-name">Remote host onboarding with Elemental</span></a></li></ol></li><li><a href="id-components-used-2.html" class="has-children "><span class="title-number">II </span><span class="title-name">Components Used</span></a><ol><li><a href="id-elemental-2.html" class=" "><span class="title-number">5 </span><span class="title-name">Elemental</span></a></li><li><a href="id-fleet.html" class=" "><span class="title-number">6 </span><span class="title-name">Fleet</span></a></li><li><a href="id-longhorn.html" class=" "><span class="title-number">7 </span><span class="title-name">Longhorn</span></a></li><li><a href="id-metal.html" class=" "><span class="title-number">8 </span><span class="title-name">Metal³</span></a></li><li><a href="id-metallb.html" class=" "><span class="title-number">9 </span><span class="title-name">MetalLB</span></a></li><li><a href="id-neuvector.html" class=" "><span class="title-number">10 </span><span class="title-name">NeuVector</span></a></li><li><a href="id-rancher.html" class=" "><span class="title-number">11 </span><span class="title-name">Rancher</span></a></li><li><a href="id-sle-micro.html" class=" "><span class="title-number">12 </span><span class="title-name">SLE Micro</span></a></li><li><a href="id-k3s.html" class=" "><span class="title-number">13 </span><span class="title-name">K3s</span></a></li><li><a href="id-rke2.html" class=" "><span class="title-number">14 </span><span class="title-name">RKE2</span></a></li><li><a href="id-edge-image-builder.html" class=" "><span class="title-number">15 </span><span class="title-name">Edge Image Builder</span></a></li></ol></li><li><a href="id-third-party-integration.html" class="has-children "><span class="title-number">III </span><span class="title-name">Third Party Integration</span></a><ol><li><a href="id-create-a-package-rpm-or-container-image-using-obs-opensuse-build-service.html" class=" "><span class="title-number">16 </span><span class="title-name">Create a package (RPM or Container image) using OBS (openSUSE Build Service)</span></a></li><li><a href="id-using-the-linkerd-service-mesh.html" class=" "><span class="title-number">17 </span><span class="title-name">Using the Linkerd Service Mesh</span></a></li><li><a href="id-nats.html" class=" "><span class="title-number">18 </span><span class="title-name">NATS</span></a></li><li><a href="id-nvidia-gpus-on-sle-micro.html" class=" "><span class="title-number">19 </span><span class="title-name">NVIDIA GPU’s on SLE Micro</span></a></li></ol></li><li class="active"><a href="id-product-documentation.html" class="has-children you-are-here"><span class="title-number">IV </span><span class="title-name">Product Documentation</span></a><ol><li><a href="atip.html" class=" you-are-here"><span class="title-number">20 </span><span class="title-name">SUSE Adaptive Telco Infrastructure Platform (ATIP)</span></a></li></ol></li><li><a href="id-appendix.html" class="has-children "><span class="title-number">A </span><span class="title-name">Appendix</span></a><ol><li><a href="id-appendix.html#id-terminology" class=" "><span class="title-number"> </span><span class="title-name">Terminology</span></a></li></ol></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="atip" data-id-title="SUSE Adaptive Telco Infrastructure Platform (ATIP)"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">20 </span><span class="title-name">SUSE Adaptive Telco Infrastructure Platform (ATIP)</span></span> <a title="Permalink" class="permalink" href="atip.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>SUSE ATIP is a platform designed for hosting modern, cloud native, Telco applications at scale from core to edge.</p><p>This is the home of ATIP Documentation. This documentation is currently in <span class="strong"><strong><span class="emphasis"><em>Draft state and used at your own risk</em></span></strong></span></p><p>ATIP Comprises multiple components including SLE Micro, RKE2, Rancher and others. This documentation will provide instructions on their installation, configuration and lifecycle management</p><section class="sect1" id="id-concept-architecture" data-id-title="Concept Architecture"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.1 </span><span class="title-name">Concept &amp; Architecture</span></span> <a title="Permalink" class="permalink" href="atip.html#id-concept-architecture">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>SUSE ATIP is a platform designed for hosting modern, cloud native, Telco applications at scale from core to edge.</p><p>This page explains the architecture and concepts used in ATIP. Knowledge of this will assist in deploying and using ATIP.</p><section class="sect2" id="id-components" data-id-title="Components"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.1.1 </span><span class="title-name">Components</span></span> <a title="Permalink" class="permalink" href="atip.html#id-components">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Components used in ATIP, versions, roles etc</p></section><section class="sect2" id="id-atip-architecture" data-id-title="ATIP Architecture"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.1.2 </span><span class="title-name">ATIP Architecture</span></span> <a title="Permalink" class="permalink" href="atip.html#id-atip-architecture">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Architecture of ATIP, relationship between components etc</p></section><section class="sect2" id="id-example-deployment-flows" data-id-title="Example deployment flows"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.1.3 </span><span class="title-name">Example deployment flows</span></span> <a title="Permalink" class="permalink" href="atip.html#id-example-deployment-flows">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Example high level sequences for deployment and use of ATIP in common scenarios</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Management on central site, edge sites with Multus + SRIOV</p></li><li class="listitem"><p>Management on Public cloud, edge sites with RT kernel</p></li><li class="listitem"><p>etc</p></li></ul></div></section></section><section class="sect1" id="id-requirements-assumptions" data-id-title="Requirements Assumptions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.2 </span><span class="title-name">Requirements &amp; Assumptions</span></span> <a title="Permalink" class="permalink" href="atip.html#id-requirements-assumptions">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><section class="sect2" id="id-hardware" data-id-title="Hardware"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.1 </span><span class="title-name">Hardware</span></span> <a title="Permalink" class="permalink" href="atip.html#id-hardware">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Minimum hardware specs, support, validated designs, stack validation etc</p></section><section class="sect2" id="id-network" data-id-title="Network"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.2 </span><span class="title-name">Network</span></span> <a title="Permalink" class="permalink" href="atip.html#id-network">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Expected network setup, example setups</p></section><section class="sect2" id="id-services-dhcp-dns-etc" data-id-title="Services (DHCP, DNS, etc)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.3 </span><span class="title-name">Services (DHCP, DNS, etc)</span></span> <a title="Permalink" class="permalink" href="atip.html#id-services-dhcp-dns-etc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>External services required by ATIP, common options for DHCP, DNS, etc.</p></section><section class="sect2" id="id-disable-rebootmgr" data-id-title="Disable rebootmgr"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.4 </span><span class="title-name">Disable rebootmgr</span></span> <a title="Permalink" class="permalink" href="atip.html#id-disable-rebootmgr">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p><code class="literal">rebootmgr</code> is a service which allow to configure a strategic for reboot in case system have some updates available pending.
For telco workloads is really important to disable or configure properly the rebootmgr service in order to avoid the reboot of the nodes in case of updates scheduled by the system.</p><div id="id-1.6.3.6.5.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about rebootmgr, please check:
<a class="link" href="https://github.com/SUSE/rebootmgr" target="_blank">https://github.com/SUSE/rebootmgr</a></p></div><p>You could verify the strategic being used as:</p><div class="verbatim-wrap highlight ini"><pre class="screen">cat /etc/rebootmgr.conf
[rebootmgr]
window-start=03:30
window-duration=1h30m
strategy=best-effort
lock-group=default</pre></div><p>and you could disable it as:</p><div class="verbatim-wrap highlight bash"><pre class="screen">sed -i 's/strategy=best-effort/strategy=off/g' /etc/rebootmgr.conf</pre></div><p>or using the rebootmgrctl command:</p><div class="verbatim-wrap highlight bash"><pre class="screen">rebootmgrctl strategy off</pre></div></section></section><section class="sect1" id="id-setting-up-the-management-cluster" data-id-title="Setting up the Management Cluster"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.3 </span><span class="title-name">Setting up the Management Cluster</span></span> <a title="Permalink" class="permalink" href="atip.html#id-setting-up-the-management-cluster">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This section explains how to install and configure the management cluster.
Rancher is a complete software stack for teams adopting containers. It addresses the operational and security challenges of managing multiple Kubernetes clusters across any infrastructure, while providing DevOps teams with integrated tools for running containerized workloads.
In our particular case, the Rancher management cluster will be the tool that will be used to manage the edge cluster lifecycle.
The server used for the management cluster can be installed on VMs or bare metal. The management cluster can be installed on a single node, but it is recommended to have at least 3 nodes/VMs for HA.</p><div id="id-1.6.3.7.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about Rancher, please check: <a class="link" href="https://rancher.com/why-rancher" target="_blank">https://rancher.com/why-rancher</a></p></div><section class="sect2" id="id-requirements" data-id-title="Requirements"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.1 </span><span class="title-name">Requirements</span></span> <a title="Permalink" class="permalink" href="atip.html#id-requirements">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A minimum of 1GB of RAM per node available to be used by the Rancher management cluster</p></li><li class="listitem"><p>Accurate time synchronization (<code class="literal">ntp</code> or <code class="literal">chronyd</code>) between all nodes in the cluster.</p></li><li class="listitem"><p>A minimum of 2 vCPUs per node available to be used by the Rancher management cluster</p></li><li class="listitem"><p>A minimum of 12GB of disk space (recomended 20GB of disk) per node available to be used by the Rancher management cluster</p></li></ul></div><div id="id-1.6.3.7.4.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about time synchronization, please check: <a class="link" href="https://documentation.suse.com/sles/15-SP4/html/SLES-all/cha-ntp.html" target="_blank">https://documentation.suse.com/sles/15-SP4/html/SLES-all/cha-ntp.html</a></p></div></section><section class="sect2" id="id-os-install" data-id-title="OS Install"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.2 </span><span class="title-name">OS Install</span></span> <a title="Permalink" class="permalink" href="atip.html#id-os-install">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This section covers the installation of the OS on the management cluster nodes. The OS used for the management cluster installation is <code class="literal">SLE Micro 5.4</code> that can be downloaded from <a class="link" href="https://www.suse.com/download/sle-micro/" target="_blank">here</a>.
Using SUSE Linux Enterprise Micro, you can build and scale differentiating edge systems across a wide range of industries including aerospace, telecom, automotive, defense, healthcare, hospitality, and manufacturing.
SUSE Linux Enterprise Micro 5.4 is available on the AMD64 and Intel 64 (x86_64), Arm 64 and IBM z System or LinuxONE (s390x) hardware architectures.</p><p>SUSE Linux Enterprise Micro provides <code class="literal">self-install ISO images</code> that enable you to deploy SLE Micro to your machine easily (either a virtual machine or a bare metal) and configure the system on the first boot.
For this installation we will use the self-install ISO: <code class="literal">SLE-Micro.x86_64-5.4.0-Default-SelfInstall-GM.install.iso</code></p><div id="id-1.6.3.7.5.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information, please refer Release Notes: <a class="link" href="https://www.suse.com/releasenotes/x86_64/SLE-Micro/5.4/" target="_blank">https://www.suse.com/releasenotes/x86_64/SLE-Micro/5.4/</a></p><p>For more information about the installation, please refer to the documentation: <a class="link" href="https://documentation.suse.com/sle-micro/5.5/" target="_blank">https://documentation.suse.com/sle-micro/5.5/</a></p></div><section class="sect3" id="preparing-the-configuration-device" data-id-title="Preparing the configuration device (Optional)"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.2.1 </span><span class="title-name">Preparing the configuration device (Optional)</span></span> <a title="Permalink" class="permalink" href="atip.html#preparing-the-configuration-device">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The following procedure describes how to prepare the configuration device in case you want to configure the system using <code class="literal">combustion</code> and <code class="literal">ignition</code> files, instead of using the JEOS Firstboot wizard:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Format the disk to any file system supported by SLE Micro: Ext3, Ext4, etc.:</p><div class="verbatim-wrap highlight bash"><pre class="screen">sudo mkfs.ext4 /dev/sdY</pre></div></li><li class="listitem"><p>Set the device label to either ignition (when either Ignition or Combustion is used) or combustion (when only Combustion is used). For the Ext4 file system:</p><div class="verbatim-wrap highlight bash"><pre class="screen">sudo e2label /dev/sdY ignition</pre></div><p>You can use any type of configuration storage media that your virtualization system or your hardware supports: ISO image, a USB flash disk, etc.</p></li><li class="listitem"><p>Mount the device:</p><div class="verbatim-wrap highlight bash"><pre class="screen">sudo mount /dev/sdY /mnt</pre></div></li><li class="listitem"><p>Create the directory structure as mentioned in <a class="link" href="https://documentation.suse.com/sle-micro/5.4/html/SLE-Micro-all/cha-images-ignition.html#" target="_blank">this link</a>:</p><div class="verbatim-wrap highlight bash"><pre class="screen">sudo mkdir -p /mnt/ignition/`</pre></div><p>or:</p><div class="verbatim-wrap highlight bash"><pre class="screen">sudo mkdir -p /mnt/combustion/</pre></div></li><li class="listitem"><p>Prior to booting for the first time, prepare all elements of the configuration that will be used by Ignition or Combustion. To log in to your system, you need to provide a password for root or set up passwordless authentication, otherwise the system will not be accessible after the first boot.</p></li></ol></div><div id="id-1.6.3.7.5.5.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about the configuration files using combustion and ignition, please refer to the documentation: <a class="link" href="https://documentation.suse.com/sle-micro/5.4/html/SLE-Micro-all/cha-images-ignition.html#" target="_blank">https://documentation.suse.com/sle-micro/5.4/html/SLE-Micro-all/cha-images-ignition.html#</a></p></div></section></section><section class="sect2" id="id-installation-4" data-id-title="Installation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.3 </span><span class="title-name">Installation</span></span> <a title="Permalink" class="permalink" href="atip.html#id-installation-4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Boot the system from the ISO image and select Install SLE Micro</p><div class="informalfigure"><div class="mediaobject"><a href="images/os1.png"><img src="images/os1.png" width="NaN" alt="mgmt_install_1.png" title="mgmt_install_1.png"/></a></div></div></li><li class="listitem"><p>Select the Installation Disk and click OK</p><div class="informalfigure"><div class="mediaobject"><a href="images/os2.png"><img src="images/os2.png" width="NaN" alt="mgmt_install_2.png" title="mgmt_install_2.png"/></a></div></div></li><li class="listitem"><p>Installation will start copying the files to disk</p><div class="informalfigure"><div class="mediaobject"><a href="images/os3.png"><img src="images/os3.png" width="NaN" alt="mgmt_install_3.png" title="mgmt_install_3.png"/></a></div></div></li><li class="listitem"><p>Once the installation is finished, the system will reboot</p></li><li class="listitem"><p>After reboot, the system will start the JEOS Firstboot wizard</p><div id="id-1.6.3.7.6.2.5.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>If you want to configure the system using <code class="literal">combustion</code> and <code class="literal">ignition</code> files, instead of using the JEOS Firstboot wizard, please refer to the section Preparing the configuration device (Optional) (<a class="xref" href="atip.html#preparing-the-configuration-device" title="20.3.2.1. Preparing the configuration device (Optional)">Section 20.3.2.1, “Preparing the configuration device (Optional)”</a>) above, and ensure your media is connected during the first boot.</p></div><div class="informalfigure"><div class="mediaobject"><a href="images/os4.png"><img src="images/os4.png" width="NaN" alt="mgmt_install_4.png" title="mgmt_install_4.png"/></a></div></div><div class="informalfigure"><div class="mediaobject"><a href="images/os5.png"><img src="images/os5.png" width="NaN" alt="mgmt_install_5.png" title="mgmt_install_5.png"/></a></div></div><div class="informalfigure"><div class="mediaobject"><a href="images/os6.png"><img src="images/os6.png" width="NaN" alt="mgmt_install_6.png" title="mgmt_install_6.png"/></a></div></div><div class="informalfigure"><div class="mediaobject"><a href="images/os7.png"><img src="images/os7.png" width="NaN" alt="mgmt_install_7.png" title="mgmt_install_7.png"/></a></div></div><div class="informalfigure"><div class="mediaobject"><a href="images/os8.png"><img src="images/os8.png" width="NaN" alt="mgmt_install_8.png" title="mgmt_install_8.png"/></a></div></div><div class="informalfigure"><div class="mediaobject"><a href="images/os9.png"><img src="images/os9.png" width="NaN" alt="mgmt_install_9.png" title="mgmt_install_9.png"/></a></div></div></li></ol></div><div id="id-1.6.3.7.6.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>During the deployment of the selfinstall ISO, the image of the system is just copied to the selected disk, therefore, an EFI boot entry is not created (like it normally would if the system is deployed using an installer). You might need to manually boot your system using the EFI shell by selecting the SLE Micro boot loader. After the first boot, you can use <code class="literal">efibootmgr</code> to create the boot entry. <code class="literal">efibootmgr</code> is available by default in the deployed image.</p></div><section class="sect3" id="id-post-installation" data-id-title="Post Installation"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.3.1 </span><span class="title-name">Post Installation</span></span> <a title="Permalink" class="permalink" href="atip.html#id-post-installation">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Registering the system is possible from the command line using the <code class="literal">transactional-update register</code> command. For information that goes beyond the scope of this section, refer to the inline documentation with `SUSEConnect --help</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>To register SUSE Linux Enterprise Micro with SUSE Customer Center, run transactional-update register as follows:</p><div class="verbatim-wrap highlight bash"><pre class="screen">transactional-update register -r REGISTRATION_CODE -e EMAIL_ADDRESS</pre></div><p>To register with a local registration server, additionally provide the URL to the server:</p><div class="verbatim-wrap highlight bash"><pre class="screen">transactional-update register -r REGISTRATION_CODE -e EMAIL_ADDRESS \
--url "https://suse_register.example.com/"</pre></div><p>Replace <code class="literal">REGISTRATION_CODE</code> with the registration code you received with your copy of SUSE Linux Enterprise Micro. Replace <code class="literal">EMAIL_ADDRESS</code> with the e-mail address associated with the SUSE account you or your organization uses to manage subscriptions.</p></li><li class="listitem"><p>Reboot your system to switch to the latest snapshot.</p></li><li class="listitem"><p>SUSE Linux Enterprise Micro is now registered.</p></li></ol></div></section></section><section class="sect2" id="id-rke2-cluster-install" data-id-title="RKE2 Cluster Install"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.4 </span><span class="title-name">RKE2 Cluster Install</span></span> <a title="Permalink" class="permalink" href="atip.html#id-rke2-cluster-install">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This section covers the installation of the RKE2 cluster on the management cluster nodes:</p><div id="id-1.6.3.7.7.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information, please refer to the documentation: <a class="link" href="https://docs.rke2.io/install/quickstart/" target="_blank">https://docs.rke2.io/install/quickstart/</a></p></div><section class="sect3" id="id-server-node-installation-command" data-id-title="Server node installation command:"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.4.1 </span><span class="title-name">Server node installation command:</span></span> <a title="Permalink" class="permalink" href="atip.html#id-server-node-installation-command">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Run the installer:</p><div class="verbatim-wrap highlight bash"><pre class="screen">curl -sfL https://get.rke2.io | sh -</pre></div><p>if you want to install a especific version, you can use the following command (i.e. <code class="literal">v1.25.9+rke2r1</code>):</p><div class="verbatim-wrap highlight bash"><pre class="screen">curl -sfL https://get.rke2.io | INSTALL_RKE2_VERSION="v1.25.9+rke2r1" sh -</pre></div><div id="id-1.6.3.7.7.4.2.1.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about the installation, please refer to the documentation: <a class="link" href="https://docs.rke2.io/install/install_options/" target="_blank">https://docs.rke2.io/install/install_options/</a></p></div></li><li class="listitem"><p>Enable the rke2-server service:</p><div class="verbatim-wrap highlight bash"><pre class="screen">systemctl enable rke2-server.service</pre></div></li><li class="listitem"><p>Start the service:</p><div class="verbatim-wrap highlight bash"><pre class="screen">systemctl start rke2-server.service</pre></div></li></ol></div></section></section><section class="sect2" id="id-agent-node-installation-command" data-id-title="Agent node installation command:"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.5 </span><span class="title-name">Agent node installation command:</span></span> <a title="Permalink" class="permalink" href="atip.html#id-agent-node-installation-command">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Run the installer:</p><div class="verbatim-wrap highlight bash"><pre class="screen">curl -sfL https://get.rke2.io | INSTALL_RKE2_TYPE="agent" sh -</pre></div></li><li class="listitem"><p>Enable the rke2-agent service:</p><div class="verbatim-wrap highlight bash"><pre class="screen">systemctl enable rke2-agent.service</pre></div></li><li class="listitem"><p>Configure the config.yaml file located in <code class="literal">/etc/rancher/rke2/</code> with the following content:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">server: https://&lt;server&gt;:9345
token: &lt;token from server node&gt;</pre></div></li><li class="listitem"><p>Start the service:</p><div class="verbatim-wrap highlight bash"><pre class="screen">systemctl start rke2-agent.service</pre></div></li></ol></div></section><section class="sect2" id="id-rancher-manager-install" data-id-title="Rancher Manager Install"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.6 </span><span class="title-name">Rancher Manager Install</span></span> <a title="Permalink" class="permalink" href="atip.html#id-rancher-manager-install">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Rancher is installed using the Helm package manager for Kubernetes.
Helm charts provide templating syntax for Kubernetes YAML manifest documents. With Helm, we can create configurable deployments instead of just using static files.</p><div id="id-1.6.3.7.9.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>This section covers the installation of Rancher on the management cluster nodes.</p><p>For more information about the installation, please refer to the documentation: <a class="link" href="https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster" target="_blank">https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster</a></p></div><section class="sect3" id="id-add-the-helm-repository" data-id-title="Add the Helm repository"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.6.1 </span><span class="title-name">Add the Helm repository</span></span> <a title="Permalink" class="permalink" href="atip.html#id-add-the-helm-repository">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>There are three releases available to be added as a Helm repository for Rancher. In our case, we will use the <code class="literal">rancher-stable</code> because it’s the release recommended for production environments, but you could use <code class="literal">rancher-latest</code> or <code class="literal">rancher-alpha</code> if you want. Also, there is a <code class="literal">rancher primer</code> release that is the enterprise version of Rancher.</p><div class="verbatim-wrap highlight bash"><pre class="screen">helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</pre></div><div id="id-1.6.3.7.9.4.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>If you don’t have <code class="literal">helm</code> installed previously, you could install it using the following command:</p><div class="verbatim-wrap highlight bash"><pre class="screen">curl -fsSL \
https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 |bash</pre></div></div></section><section class="sect3" id="id-choose-your-ssl-configuration" data-id-title="Choose your SSL Configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.6.2 </span><span class="title-name">Choose your SSL Configuration</span></span> <a title="Permalink" class="permalink" href="atip.html#id-choose-your-ssl-configuration">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The Rancher management server is designed to be secure by default and requires SSL/TLS configuration.</p><p>There are three recommended options for SSL/TLS configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Rancher-generated TLS certificate</p></li><li class="listitem"><p>Let’s Encrypt</p></li><li class="listitem"><p>Bring your own certificate</p></li></ul></div><div id="id-1.6.3.7.9.5.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about the SSL/TLS configuration, please refer to the
documentation:
<a class="link" href="https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster/#3-choose-your-ssl-configuration" target="_blank">https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster/#3-choose-your-ssl-configuration</a></p></div><p>In our case we will use the Rancher-generated TLS certificate:</p><div class="verbatim-wrap highlight bash"><pre class="screen">helm repo add jetstack https://charts.jetstack.io
helm repo update
helm install cert-manager jetstack/cert-manager \
 --namespace cert-manager \
 --create-namespace \
 --set installCRDs=true \
 --version v1.11.1</pre></div><p>Once you’ve installed cert-manager, you can verify the pods are running:</p><div class="verbatim-wrap highlight bash"><pre class="screen">kubectl get pods --namespace cert-manager</pre></div></section><section class="sect3" id="id-install-rancher-with-helm-and-your-chosen-certificate-option" data-id-title="Install Rancher with Helm and your chosen certificate option"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.6.3 </span><span class="title-name">Install Rancher with Helm and your chosen certificate option</span></span> <a title="Permalink" class="permalink" href="atip.html#id-install-rancher-with-helm-and-your-chosen-certificate-option">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>You can install Rancher with helm using the following command modifying the <code class="literal">&lt;hostname&gt;</code> and <code class="literal">&lt;bootstrapPassword&gt;</code> values:</p><div class="verbatim-wrap highlight bash"><pre class="screen">helm install rancher rancher-stable/rancher \
 --namespace cattle-system \
 --create-namespace \
 --set hostname=&lt;hostname&gt; \
 --set bootstrapPassword=&lt;bootstrapPassword&gt; \
 --set replicas=1 \
 --set global.cattle.psp.enabled=false</pre></div></section><section class="sect3" id="id-verify-the-rancher-installation" data-id-title="Verify the Rancher installation"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.6.4 </span><span class="title-name">Verify the Rancher installation</span></span> <a title="Permalink" class="permalink" href="atip.html#id-verify-the-rancher-installation">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>You should wait a few minutes for Rancher to be rolled out:</p><div class="verbatim-wrap highlight bash"><pre class="screen">kubectl -n cattle-system rollout status deploy/rancher</pre></div></section></section><section class="sect2" id="id-initial-configuration" data-id-title="Initial Configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.7 </span><span class="title-name">Initial Configuration</span></span> <a title="Permalink" class="permalink" href="atip.html#id-initial-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>TBC - Initial configuration necessary to begin creating edge cluster</p></section><section class="sect2" id="id-bare-metal-management-configuration" data-id-title="Bare Metal Management Configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.8 </span><span class="title-name">Bare Metal Management Configuration</span></span> <a title="Permalink" class="permalink" href="atip.html#id-bare-metal-management-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>TBC - Integration and setup of Metal3/CAPI components</p></section></section><section class="sect1" id="id-edge-site-installation" data-id-title="Edge Site Installation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.4 </span><span class="title-name">Edge Site Installation</span></span> <a title="Permalink" class="permalink" href="atip.html#id-edge-site-installation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This section documents the creation of edge sites using the management cluster created in the previous section.
There are different ways to create edge sites, depending on the use case. Also, there are different options to customize the edge site creation with the most common Telco/Edge options</p><p>We will cover the following topics which are really interesting for the Telco industry:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Edge site definition (<a class="xref" href="atip.html#edge-site-definition" title="20.4.1. Edge site definition">Section 20.4.1, “Edge site definition”</a>): Basic definition of an edge site.</p></li><li class="listitem"><p>Custom Registry (<a class="xref" href="atip.html#custom-registry" title="20.4.1.2. Custom Registry">Section 20.4.1.2, “Custom Registry”</a>): Extra registries to be used by the edge site.</p></li><li class="listitem"><p>CPU Management Policy (<a class="xref" href="atip.html#cpu-management-policy" title="20.4.1.3. CPU Management Policy">Section 20.4.1.3, “CPU Management Policy”</a>): CPU management policy to be used by the edge site.</p></li><li class="listitem"><p>Networking (<a class="xref" href="atip.html#networking" title="20.4.1.4. Networking">Section 20.4.1.4, “Networking”</a>): Networking configuration to be used by the edge site.</p></li><li class="listitem"><p>Installation process (<a class="xref" href="atip.html#installation-process" title="20.4.2. Installation process">Section 20.4.2, “Installation process”</a>): Installation process of the new edge site.</p></li></ul></div><section class="sect2" id="edge-site-definition" data-id-title="Edge site definition"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.4.1 </span><span class="title-name">Edge site definition</span></span> <a title="Permalink" class="permalink" href="atip.html#edge-site-definition">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The new Edge definition will be steps required to create and configure properly a new edge cluster from the Rancher Management tool.
We will also offer some extra options which are really common used in the Telco industry to customize the edge site creation in case you need some of them.</p><section class="sect3" id="id-create-new-edge-site" data-id-title="Create new edge site"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.4.1.1 </span><span class="title-name">Create new edge site</span></span> <a title="Permalink" class="permalink" href="atip.html#id-create-new-edge-site">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>To create a new edge site, you need to go to the <code class="literal">Clusters</code> section and click on <code class="literal">Create</code> button:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_1.png"><img src="images/edge_install_1.png" width="NaN" alt="edge_install_1.png" title="edge_install_1.png"/></a></div></div></li><li class="listitem"><p>Then, you could select the provider to be used to create the new edge site. In our case, we will use <code class="literal">Custom</code> provider:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_2.png"><img src="images/edge_install_2.png" width="NaN" alt="edge_install_2.png" title="edge_install_2.png"/></a></div></div></li><li class="listitem"><p>Next step is to name the new edge site and select the cluster version to be used:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_3.png"><img src="images/edge_install_3.png" width="NaN" alt="edge_install_3.png" title="edge_install_3.png"/></a></div></div></li><li class="listitem"><p>Now, it’s time to customize our installation defining some of the most common Telco/Edge options.</p><p>To do that we will use the next tabs on the left side:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_4.png"><img src="images/edge_install_4.png" width="NaN" alt="edge_install_4.png" title="edge_install_4.png"/></a></div></div></li></ol></div></section><section class="sect3" id="custom-registry" data-id-title="Custom Registry"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.4.1.2 </span><span class="title-name">Custom Registry</span></span> <a title="Permalink" class="permalink" href="atip.html#custom-registry">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Rancher offers the possibility to use extra registries to be used by the edge site. This is really useful in case you need to use some extra images which are not available in the default registries, but you’ve got deployed another internal registry to be used by your edge site.
In case you need to add some extra registries, you could do it from the <code class="literal">Custom Registry</code> tab:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Enable the extra registry adding the private registry information</p><p>To enable the private registries, you need to click on <code class="literal">Enable cluster scoped container registry</code> but take care don’t change the value, in order to keep the default Rancher registry available for the system images.
The idea is to keep the default registry for the system images using the rancher registry, and then, add a new registry (named mirror) to use a secondary private registry where your application images are stored:</p><p>To do that, you should enable the option <code class="literal">Enable cluster scoped container registry</code> keeping the container registry empty (to use the default for system images), and then, add a new private registry information:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_5.png"><img src="images/edge_install_5.png" width="NaN" alt="edge_install_5.png" title="edge_install_5.png"/></a></div></div></li><li class="listitem"><p>You could also add some information regarding the authentication to be used by the private registry:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_6.png"><img src="images/edge_install_6.png" width="NaN" alt="edge_install_6.png" title="edge_install_6.png"/></a></div></div></li><li class="listitem"><p>If you want to modify directly using a yaml file the private registry information, you could do it using the next yaml file (you could download it from the <code class="literal">Edit as YAML</code> button):</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_7.png"><img src="images/edge_install_7.png" width="NaN" alt="edge_install_7.png" title="edge_install_7.png"/></a></div></div></li></ol></div></section><section class="sect3" id="cpu-management-policy" data-id-title="CPU Management Policy"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.4.1.3 </span><span class="title-name">CPU Management Policy</span></span> <a title="Permalink" class="permalink" href="atip.html#cpu-management-policy">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Rancher offers the possibility to use different CPU management policies on RKE2 to be used by the edge site.
This is really useful if you need to tune the cpu cores management that you will offer to your workloads running on top of kubernetes.</p><div id="id-1.6.3.8.5.5.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about the different CPU management policies available in Kubernetes, please check the <a class="link" href="https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/" target="_blank">official documentation</a></p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>To modify the kubelet in order to allow some cpu management policies you could do it from the <code class="literal">Advanced</code> tab:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_8.png"><img src="images/edge_install_8.png" width="NaN" alt="edge_install_8.png" title="edge_install_8.png"/></a></div></div></li><li class="listitem"><p>You could add some cpu management policies using the <code class="literal">kubeReserved</code> and <code class="literal">systemReserved</code> options:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_9.png"><img src="images/edge_install_9.png" width="NaN" alt="edge_install_9.png" title="edge_install_9.png"/></a></div></div><p>Also, you could add some machine labels in order to match with the node labels that you will use in your workloads.</p></li><li class="listitem"><p>If you want to modify directly the information regarding the kubelet, you could do it using the next yaml file (you could download it from the <code class="literal">Edit as YAML</code> button):</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_10.png"><img src="images/edge_install_10.png" width="NaN" alt="edge_install_10.png" title="edge_install_10.png"/></a></div></div></li></ol></div></section><section class="sect3" id="networking" data-id-title="Networking"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.4.1.4 </span><span class="title-name">Networking</span></span> <a title="Permalink" class="permalink" href="atip.html#networking">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Rancher offers the possibility to use different networking options to be used by the edge site.
Also you could install directly some CNI plugins to be used by the edge site like Calico, Cilium, Multus, and the combination with Multus</p><p>In our case, we will use the Multus + calico combination, but you could use whatever you want.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Configure the Container Network Interface (CNI) plugin to be used by the edge site:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_11.png"><img src="images/edge_install_11.png" width="NaN" alt="edge_install_11.png" title="edge_install_11.png"/></a></div></div></li><li class="listitem"><p>Define some extra options using the <code class="literal">Add-On Config</code> tab (optional - if you need some specific options for the CNI plugins):</p><p>In case you need to modify some more specific options regarding the CNI plugins you could do it using the next yamls files which contains the configuration for the CNI plugins:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_13.png"><img src="images/edge_install_13.png" width="NaN" alt="edge_install_13.png" title="edge_install_13.png"/></a></div></div><p>Also, you could define the general network for the cluster to be used by the edge site:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_12.png"><img src="images/edge_install_12.png" width="NaN" alt="edge_install_12.png" title="edge_install_12.png"/></a></div></div></li></ol></div></section></section><section class="sect2" id="installation-process" data-id-title="Installation process"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.4.2 </span><span class="title-name">Installation process</span></span> <a title="Permalink" class="permalink" href="atip.html#installation-process">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>After the edge site definition, you could click on the <code class="literal">Create</code> button to start the installation process:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_14.png"><img src="images/edge_install_14.png" width="NaN" alt="edge_install_14.png" title="edge_install_14.png"/></a></div></div><p>In our case, we’ve selected the node role <code class="literal">etcd</code>, <code class="literal">control plane</code>, and <code class="literal">worker</code> because we want to deploy a single node cluster, but you could select whatever you want depending on your use case.</p></li><li class="listitem"><p>The next step should be copy the registration command to be used by the new edge node, and then, execute it on the new edge cluster server to start the installation process.</p><div id="id-1.6.3.8.6.2.2.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>You could use the insecure check option in order to skip the TLS verification if your server has a self-signed certificate.</p></div></li><li class="listitem"><p>During the installation you could see the process using the <code class="literal">Conditions</code> and the <code class="literal">Recent Events</code> tabs:</p><div class="informalfigure"><div class="mediaobject"><a href="images/edge_install_15.png"><img src="images/edge_install_15.png" width="NaN" alt="edge_install_15.png" title="edge_install_15.png"/></a></div></div><p>After the installation process, you could see the new edge site created successfully on the Home page or in the Clusters section.</p></li></ol></div></section></section><section class="sect1" id="id-feature-configuration" data-id-title="Feature Configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.5 </span><span class="title-name">Feature Configuration</span></span> <a title="Permalink" class="permalink" href="atip.html#id-feature-configuration">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This section documents how to configuration telco specific features on ATIP deployed clusters</p><p>We will cover the next topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Bios configuration (<a class="xref" href="atip.html#bios-configuration" title="20.5.1. Bios configuration">Section 20.5.1, “Bios configuration”</a>): Bios configuration to be used by the real time kernel to optimize the performance in the hardware.</p></li><li class="listitem"><p>Kernel image for Real Time (<a class="xref" href="atip.html#kernel-image-for-real-time" title="20.5.2. Kernel Image for Real Time">Section 20.5.2, “Kernel Image for Real Time”</a>): Kernel image to be used by the real time kernel.</p></li><li class="listitem"><p>CPU Tuned configuration (<a class="xref" href="atip.html#cpu-tuned-configuration" title="20.5.3. CPU Tuned Configuration">Section 20.5.3, “CPU Tuned Configuration”</a>): Tuned configuration to be used by the real time kernel.</p></li><li class="listitem"><p>Multus-Calico configuration (<a class="xref" href="atip.html#multus-calico" title="20.5.4. Multus + Calico">Section 20.5.4, “Multus + Calico”</a>): Multus configuration to be used by the kubernetes cluster.</p></li><li class="listitem"><p>SRIOV configuration (<a class="xref" href="atip.html#sriov" title="20.5.5. SRIOV">Section 20.5.5, “SRIOV”</a>): SRIOV configuration to be used by the kubernetes workloads.</p></li><li class="listitem"><p>DPDK configuration (<a class="xref" href="atip.html#dpdk" title="20.5.6. DPDK">Section 20.5.6, “DPDK”</a>): DPDK configuration to be used by system.</p></li><li class="listitem"><p>Huge Pages (<a class="xref" href="atip.html#huge-pages" title="20.5.9. Huge Pages">Section 20.5.9, “Huge Pages”</a>): Huge Pages configuration to be used by the kubernetes workloads.</p></li><li class="listitem"><p>CPU Pinning configuration (<a class="xref" href="atip.html#cpu-pinning-configuration" title="20.5.10. CPU Pinning Configuration">Section 20.5.10, “CPU Pinning Configuration”</a>): CPU Pinning configuration to be used by the kubernetes workloads.</p></li><li class="listitem"><p>NUMA Aware scheduling configuration (<a class="xref" href="atip.html#numa-aware-scheduling" title="20.5.11. NUMA Aware scheduling">Section 20.5.11, “NUMA Aware scheduling”</a>): NUMA Aware scheduling configuration to be used by the kubernetes workloads.</p></li><li class="listitem"><p>Metal LB configuration (<a class="xref" href="atip.html#metal-lb-configuration" title="20.6. Metal LB (Beta)">Section 20.6, “Metal LB (Beta)”</a>): Metal LB configuration to be used by the kubernetes workloads.</p></li></ul></div><section class="sect2" id="bios-configuration" data-id-title="Bios configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.1 </span><span class="title-name">Bios configuration</span></span> <a title="Permalink" class="permalink" href="atip.html#bios-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div id="id-1.6.3.9.5.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>This configuration depends on the hardware vendor, so please, check with your hardware vendor the best configuration to be used.</p></div><p>This section is really important to optimize the performance of the real time kernel in the hardware, because some of this parameters could increase not limiting the performance of the real time kernel.
The next table shows the recommended configuration for the most common hardware vendors:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">Option</th><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">Value</th><th style="text-align: left; vertical-align: top; border-bottom: 1px solid ; ">Description</th></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Workload Profile</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Telco Optimized</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>Telco profile to optimize the performance in the hardware.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Boot Performance Mode</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Max. Performance</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>Maximize the performance in the boot process.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Hyper- Threading (Logical Proccesor)</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Enable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option enables Intel® Hyper-Threading Technology for logical processor enabling and converting processor cores (pCores) to logical cores (lCores).</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Virtualization Technology (XAPIC)</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Enable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option is for Extended Advanced Programmable Interrupt Controller (xAPIC) support for the Intel® Virtualization Technology for Directed I/O (Intel® VT-d) feature.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>uncore frequency scaling</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>If enabled, Uncore Frequency Scaling (UFS) allows the uncore to operate at a lower frequency when the Power Control Unit (PCU) has detected low utilization. Conversely, UFS allows the uncore to operate at a higher frequency when the PCU has detected high utilization.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>CPU P-State Control (EIST PSD Function</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>HW_ALL</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>optimization of the voltage and CPU fequency during operation</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>CPU C-State Control</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option is for the CPU C-State Control feature, which provides power savings by placing the processor into lower power states when the processor is idle.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>CPU C1E Support</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option is for the CPU Enhanced Halt (C1E) feature, which provides power savings by placing the processor into a low power state when the processor is idle.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>AVX License Pre-Grant</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Enable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>If enabled, this option enables the pre-grant license level selection based on workload with the AVX ICCP Pre-Grant Level option.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>AVX ICCP Pre- Grant Level</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Level 5</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option selects a workload level for the Intel® Advanced Vector Extensions (Intel® AVX): Intel® AVX-512 Heavy</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>AVX P1</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Level 2</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option serves a dual purpose: 1 -Specifies the base P1 ratio for Intel® Streaming SIMD Extensions (Intel® SSE) or Intel® AVX workloads. 2- Pre-grants a license level based on the workload level.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Energy Efficient Turbo</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows entry into the Intel® Turbo Boost Technology frequency when the Power Control Unit (PCU) has detected high utilization.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Turbo Mode</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Enable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>Enabling this Intel® Turbo Boost Technology mode setting allows the CPU cores to operate at higher than the rated frequency.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>GPSS timer</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>0us</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the reduction of the Global P-State Selection (GPSS) timer to be set from: 0 μs to 500 μs</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>LLC prefetch</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Enable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option enables Last Level Cache (LLC) hardware prefetch logic.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Frequency Prioritization (RAPL Prioritization)</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This setting controls whether the Running Average Power Limit (RAPL) balancer is enabled. If enabled, it activates per core power budgeting.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Hardware P-States</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Native with no Legacy Support</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>When enabled, this option allows the hardware to choose a Performance State (P-State) based on an OS request (that is, a legacy P-State).</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>EPP enable3</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>When this option is enabled, the system uses the energy performance bias register for the Energy Performance Preference (EPP) input to make decision on Performance State (P-State) or Processor Core Idle State (C-State) transitions.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>APS Rocketing</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>Rocketing mechanism in the HWP p-state selection for pcode algorithm. Rocketing enables the core ratio to jump to max turbo instantaneously as opposed to a smooth ramp</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Scalability</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>Core Performance to frequency scalability based on optimizations in the CPU.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Native ASPM</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>ASPM off not controlled by BIOS or OS.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Power Performance Tuning</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>OS Controls EPB</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option selects the BIOS or OS that controls the Energy Performance Bias (EPB) functionality.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Workload Configuration</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>I/O sensitive</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the system power and performance profile to be set to favor compute intensive workload or I/O sensitive workload.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Dynamic L1</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Disable</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option applies only to the package-level setting to allow dynamically entering the lower power link state L1.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Set Fan Profile</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>Performance</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the fan profile to be set to Performance, Balanced, or Quiet.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>Cooling Configuration - Fan Speed Offset</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>Medium</p></td><td style="text-align: left; vertical-align: top; "><p>This option allows the fan speed offset to be set to Low, Medium, or High.</p></td></tr></tbody></table></div></section><section class="sect2" id="kernel-image-for-real-time" data-id-title="Kernel Image for Real Time"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.2 </span><span class="title-name">Kernel Image for Real Time</span></span> <a title="Permalink" class="permalink" href="atip.html#kernel-image-for-real-time">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The real time kernel image is not necessarily better than a standard kernel.
It is a different kernel tuned to a specific use case. The real time kernel is tuned for lower latency at the cost of throughput. The real time kernel is not recommended for general purpose use, but in our case, this is the recommended kernel for Telco Workloads.</p><p>There are 4 top features:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Deterministic Execution:</p><p>Get greater predictability — ensure critical business processes complete in time, every time and deliver high quality of service, even under heavy system loads. By shielding key system resources for high-priority processes, you can ensure greater predictability for time-sensitive applications.</p></li><li class="listitem"><p>Low Jitter:</p><p>The low jitter built upon the highly deterministic technology helps to keep applications synchronized with the real world. This helps services that need ongoing and repeated calculation.</p></li><li class="listitem"><p>Priority Inheritance:</p><p>Priority inheritance refers to the ability of a lower priority process to assume a higher priority when there is a higher priority process that requires the lower priority process to finish before it can accomplish its task. SUSE Linux Enterprise Real Time solves these priority inversion problems for mission-critical processes.</p></li><li class="listitem"><p>Thread Interrupts:</p><p>Processes running in interrupt mode in a general-purpose operating system are not preemptible. With SUSE Linux Enterprise Real Time these interrupts have been encapsulated by kernel threads, which are interruptible, and in turn allow the hard and soft interrupts to be preempted by user-defined higher priority processes.</p><p>In our case, if you have installed a real time image like SLE Micro RT, kernel real time is already installed and you don’t need to install it again.</p><p>You could check it looking for the kernel and see if contains the <span class="strong"><strong><code class="literal">rt</code></strong></span> string at the end of the kernel info:</p><div class="verbatim-wrap highlight bash"><pre class="screen">uname -r
5.14.21-150400.15.11-rt</pre></div></li></ul></div><div id="id-1.6.3.9.6.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about the real time kernel, please visit
<a class="link" href="https://www.suse.com/products/realtime/" target="_blank">https://www.suse.com/products/realtime/</a></p></div></section><section class="sect2" id="cpu-tuned-configuration" data-id-title="CPU Tuned Configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.3 </span><span class="title-name">CPU Tuned Configuration</span></span> <a title="Permalink" class="permalink" href="atip.html#cpu-tuned-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The first thing is to create a profile for the cpu cores we want to isolate. In this case, we will isolate the cores 1-30 and 33-62.</p><div class="verbatim-wrap"><pre class="screen">echo "export tuned_params" &gt;&gt; /etc/grub.d/00_tuned

echo "isolated_cores=1-30,33-62" &gt;&gt; /etc/tuned/cpu-partitioning-variables.conf

tuned-adm profile cpu-partitioning
Cannot talk to Tuned daemon via DBus. Is Tuned daemon running?
Trying to (re)start tuned...
Tuned (re)started, changes applied.</pre></div><p>Then we need to modify grub option to isolate cpu cores as well as another important parameters for the cpu usage.</p><p>Modify in /etc/default/grub the next line, to add the cpu cores to isolate. The next options are the most important to be customized with your current hardware:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">parameter</th><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">value</th><th style="text-align: left; vertical-align: top; border-bottom: 1px solid ; ">description</th></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>isolcpu</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>1-30,33-62</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>Isolate the cores 1-30 and 33-62</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>skew_tick</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>1</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the kernel to skew the timer interrupts across the isolated CPUs.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>nohz</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>on</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the kernel to run the timer tick on a single CPU when the system is idle.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>nohz_full</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>1-30,33-62</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>kernel boot parameter is the current main interface to configure full dynticks along with CPU Isolation.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>rcu_nocbs</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>1-30,33-62</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the kernel to run the RCU callbacks on a single CPU when the system is idle.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>kthread_cpus</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>0,31,32,63</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the kernel to run the kthreads on a single CPU when the system is idle.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>irqaffinity</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>0,31,32,63</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows the kernel to run the interrupts on a single CPU when the system is idle.</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>processor.max_cstate</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>1</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option prevents the CPU from dropping into a sleep state when idle</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>intel_idle.max_cstate</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>0</p></td><td style="text-align: left; vertical-align: top; "><p>This option disables the intel_idle driver and allows acpi_idle to be used</p></td></tr></tbody></table></div><p>With the values showed above, we are isolating 60 cores, and we are using 4 cores for the OS.</p><p>Let’s modify the grub file with the previous values:</p><div class="verbatim-wrap"><pre class="screen">vi /boot/efi/EFI/sle_rt/grub.cfg
	set tuned_params="skew_tick=1 nohz=on nohz_full=1-30,33-62 rcu_nocbs=1-30,33-62 tuned.non_isolcpus=80000001,80000001 nosoftlockup"

vi /etc/default/grub
    GRUB_CMDLINE_LINUX="intel_iommu=on intel_pstate=passive processor.max_cstate=1 intel_idle.max_cstate=0 iommu=pt usbcore.autosuspend=-1 selinux=0 enforcing=0 nmi_watchdog=0 crashkernel=auto softlockup_panic=0 audit=0 mce=off hugepagesz=1G hugepages=40 hugepagesz=2M hugepages=0 default_hugepagesz=1G kthread_cpus=0,31,32,63 irqaffinity=0,31,32,63 isolcpu=1-30,33-62 skew_tick=1 nohz_full=1-30,33-62 rcu_nocbs=1-30,33-62 rcu_nocb_poll"

transactional-update grub.cfg</pre></div><p>To validate that the parameters are applied after reboot, you could check:</p><div class="verbatim-wrap highlight bash"><pre class="screen">cat /proc/cmdline</pre></div></section><section class="sect2" id="multus-calico" data-id-title="Multus + Calico"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.4 </span><span class="title-name">Multus + Calico</span></span> <a title="Permalink" class="permalink" href="atip.html#multus-calico">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Multus CNI is a CNI plugin that enables attaching multiple network interfaces to pods. Multus does not replace CNI plugins, instead it acts as a CNI plugin multiplexer. Multus is useful in certain use cases, especially when pods are network intensive and require extra network interfaces that support dataplane acceleration techniques such as SR-IOV.</p><p>Multus can not be deployed standalone. It always requires at least one conventional CNI plugin that fulfills the Kubernetes cluster network requirements. That CNI plugin becomes the default for Multus, and will be used to provide the primary interface for all pods.
In our case, most of the workloads in Telco will be deployed using Multus + calico.</p><p>To enable Multus on RKE2 cluster, add multus as the first list entry in the cni config key, followed by the name of the plugin you want to use alongside Multus (or none if you will provide your own default plugin). Note that multus must always be in the first position of the list. For example, to use Multus with calico as the default plugin you could specify:</p><div class="verbatim-wrap highlight yaml"><pre class="screen"># /etc/rancher/rke2/config.yaml
cni:
- multus
- calico</pre></div><p>This can also be specified with command-line arguments, i.e. <code class="literal">--cni=multus,calico</code> or <code class="literal">--cni=multus --cni=calico</code>.</p><p>You could also install Multus directly during the edge cluster installation:</p><div class="informalfigure"><div class="mediaobject"><a href="images/features_multus.png"><img src="images/features_multus.png" width="NaN" alt="multus.png" title="multus.png"/></a></div></div><div id="id-1.6.3.9.8.9" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about Multus, please visit <a class="link" href="https://github.com/k8snetworkplumbingwg/multus-cni" target="_blank">https://github.com/k8snetworkplumbingwg/multus-cni</a></p><p>For more information about CNI plugins, please visit <a class="link" href="https://docs.rke2.io/install/network_options" target="_blank">https://docs.rke2.io/install/network_options</a></p></div></section><section class="sect2" id="sriov" data-id-title="SRIOV"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.5 </span><span class="title-name">SRIOV</span></span> <a title="Permalink" class="permalink" href="atip.html#sriov">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>SR-IOV allows a device, such as a network adapter, to separate access to its resources among various PCIe hardware functions.
There are different ways to deploy SRIOV, and in this case, we will show two different options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Option 1: using the SRIOV CNI device plugins and a config map to configure it properly.</p></li><li class="listitem"><p>Option 2: using the SRIOV helm chart from Rancher to make this deployment easy.</p></li></ul></div><section class="sect3" id="id-option-1-installation-of-sr-iov-cni-device-plugins-and-a-config-map-to-configure-it-properly" data-id-title="Option 1 - Installation of SR-IOV CNI device plugins and a config map to configure it properly"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.5.1 </span><span class="title-name">Option 1 - Installation of SR-IOV CNI device plugins and a config map to configure it properly</span></span> <a title="Permalink" class="permalink" href="atip.html#id-option-1-installation-of-sr-iov-cni-device-plugins-and-a-config-map-to-configure-it-properly">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><section class="sect4" id="id-prepare-the-config-map-for-the-device-plugin" data-id-title="Prepare the config map for the device plugin"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.1.1 </span><span class="title-name">Prepare the config map for the device plugin</span></span> <a title="Permalink" class="permalink" href="atip.html#id-prepare-the-config-map-for-the-device-plugin">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>You could get the information to fill the config map from the lspci command:</p><div class="verbatim-wrap"><pre class="screen">lspci | grep -i acc
8a:00.0 Processing accelerators: Intel Corporation Device 0d5c

lspci | grep -i net
xr11-1:~ # lspci | grep -i net
19:00.0 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)
19:00.1 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)
19:00.2 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)
19:00.3 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)
51:00.0 Ethernet controller: Intel Corporation Ethernet Controller E810-C for QSFP (rev 02)
51:00.1 Ethernet controller: Intel Corporation Ethernet Controller E810-C for QSFP (rev 02)
51:01.0 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)
51:01.1 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)
51:01.2 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)
51:01.3 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)
51:11.0 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)
51:11.1 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)
51:11.2 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)
51:11.3 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)</pre></div><div id="id-1.6.3.9.9.4.2.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p><code class="literal">0d5d</code> is the VF from the FEC card (take a look that it’s different than the
<code class="literal">lspci | grep acc</code> result, because it’s the VF, not the PF). Normally it’s the first VF of the card, so the last name will be consecutive after VF creation.</p></div><p>The config map consists of a JSON file that describe devices using filters to discover and creates some groups for the interfaces.
The most important is to understand the filters and the groups. The filters are used to discover the devices and the groups are used to create the interfaces.</p><p>For example, we could filter using:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>vendorID: <code class="literal">8086</code> (Intel)</p></li><li class="listitem"><p>deviceID: <code class="literal">0d5d</code> (FEC)</p></li><li class="listitem"><p>driver: <code class="literal">vfio-pci</code> (SRIOV driver)</p></li><li class="listitem"><p>pfNames: <code class="literal">p2p1</code> (PF name)</p></li></ul></div><p>We could also set placesholders like:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>pfNames: ["eth1#1,2,3,4,5,6"]</p></li></ul></div><p>Regarding the groups, we could create a group for the FEC card and another group for the Intel card even creating some prefix depending our use case:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>resourceName: <code class="literal">pci_sriov_net_bh_dpdk</code></p></li><li class="listitem"><p>resourcePrefix: <code class="literal">Rancher.io</code></p></li></ul></div><p>There are a lot of combinations in order to discover and create the resource group to allocate some VFs to the pods.</p><div id="id-1.6.3.9.9.4.2.13" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>For more information about the filters and groups, please visit <a class="link" href="https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin" target="_blank">https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin</a></p></div><div class="verbatim-wrap highlight yaml"><pre class="screen">cat &lt;&lt;EOF | k apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: sriovdp-config
  namespace: kube-system
data:
  config.json: |
    {
        "resourceList": [
            {
                "resourceName": "intel_fec_5g",
                "devicetype": "accelerator",
                "selectors": {
                    "vendors": ["8086"],
                    "devices": ["0d5d"]
                }
            },
            {
                "resourceName": "intel_sriov_odu",
                "selectors": {
                    "vendors": ["8086"],
                    "devices": ["1889"],
                    "drivers": ["vfio-pci"],
                    "pfNames": ["p2p1"]
                }
            },
            {
                "resourceName": "intel_sriov_oru",
                "selectors": {
                    "vendors": ["8086"],
                    "devices": ["1889"],
                    "drivers": ["vfio-pci"],
                    "pfNames": ["p2p2"]
                }
            }
        ]
    }
EOF</pre></div></section><section class="sect4" id="id-prepare-the-daemonset-for-the-device-plugin" data-id-title="Prepare the daemonset for the device plugin"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.1.2 </span><span class="title-name">Prepare the daemonset for the device plugin</span></span> <a title="Permalink" class="permalink" href="atip.html#id-prepare-the-daemonset-for-the-device-plugin">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>No changes are needed in the daemonset, so you can use the same upstream daemonset file.</p><div class="verbatim-wrap highlight yaml"><pre class="screen">cat &lt;&lt;EOF | k apply -f -
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sriov-device-plugin
  namespace: kube-system

---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: kube-sriov-device-plugin-amd64
  namespace: kube-system
  labels:
    tier: node
    app: sriovdp
spec:
  selector:
    matchLabels:
      name: sriov-device-plugin
  template:
    metadata:
      labels:
        name: sriov-device-plugin
        tier: node
        app: sriovdp
    spec:
      hostNetwork: true
      nodeSelector:
        kubernetes.io/arch: amd64
      tolerations:
      - key: node-role.kubernetes.io/master
        operator: Exists
        effect: NoSchedule
      serviceAccountName: sriov-device-plugin
      containers:
      - name: kube-sriovdp
        image: ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:latest-amd64
        imagePullPolicy: IfNotPresent
        args:
        - --log-dir=sriovdp
        - --log-level=10
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: "250m"
            memory: "40Mi"
          limits:
            cpu: 1
            memory: "200Mi"
        volumeMounts:
        - name: devicesock
          mountPath: /var/lib/kubelet/
          readOnly: false
        - name: log
          mountPath: /var/log
        - name: config-volume
          mountPath: /etc/pcidp
        - name: device-info
          mountPath: /var/run/k8s.cni.cncf.io/devinfo/dp
      volumes:
        - name: devicesock
          hostPath:
            path: /var/lib/kubelet/
        - name: log
          hostPath:
            path: /var/log
        - name: device-info
          hostPath:
            path: /var/run/k8s.cni.cncf.io/devinfo/dp
            type: DirectoryOrCreate
        - name: config-volume
          configMap:
            name: sriovdp-config
            items:
            - key: config.json
              path: config.json
EOF</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>After that you should see the pods running:</p><div class="verbatim-wrap"><pre class="screen">kubectl get pods -n kube-system | grep sriov
kube-system  kube-sriov-device-plugin-amd64-twjfl  1/1  Running  0  2m</pre></div></li><li class="listitem"><p>Check the interfaces discovered and available in the nodes to be used by the pods:</p><div class="verbatim-wrap"><pre class="screen">kubectl get $(kubectl get nodes -oname) -o jsonpath='{.status.allocatable}' | jq
{
  "cpu": "64",
  "ephemeral-storage": "256196109726",
  "hugepages-1Gi": "40Gi",
  "hugepages-2Mi": "0",
  "intel.com/intel_fec_5g": "1",
  "intel.com/intel_sriov_odu": "4",
  "intel.com/intel_sriov_oru": "4",
  "memory": "221396384Ki",
  "pods": "110"
}</pre></div></li><li class="listitem"><p>The FEC will be <code class="literal">intel.com/intel_fec_5g</code> and the value will be 1</p></li><li class="listitem"><p>The VF will be <code class="literal">intel.com/intel_sriov_odu</code> or <code class="literal">intel.com/intel_sriov_oru</code> if you deploy it with device plugin and the config map without helm charts</p></li></ul></div><div id="id-1.6.3.9.9.4.3.5" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>If you don’t get the interfaces available here, does not make sense continue with the workload, because interface will not be available for pods</p></div></section></section><section class="sect3" id="id-option-2-installation-using-rancher-using-helm-chart-for-sr-iov-cni-and-device-plugins" data-id-title="Option 2 - Installation using Rancher using Helm chart for SR-IOV CNI and device plugins"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2 </span><span class="title-name">Option 2 - Installation using Rancher using Helm chart for SR-IOV CNI and device plugins</span></span> <a title="Permalink" class="permalink" href="atip.html#id-option-2-installation-using-rancher-using-helm-chart-for-sr-iov-cni-and-device-plugins">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><section class="sect4" id="id-get-helm-if-not-present" data-id-title="Get helm if not present"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.1 </span><span class="title-name">Get helm if not present</span></span> <a title="Permalink" class="permalink" href="atip.html#id-get-helm-if-not-present">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight bash"><pre class="screen">curl -fsSL -o get_helm.sh \
 https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
chmod 500 get_helm.sh
./get_helm.sh</pre></div></section><section class="sect4" id="id-install-sriov" data-id-title="Install SRIOV"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.2 </span><span class="title-name">Install SRIOV</span></span> <a title="Permalink" class="permalink" href="atip.html#id-install-sriov">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This part could be done in two ways, using the CLI or using the Rancher UI</p><div class="variablelist"><dl class="variablelist"><dt id="id-1.6.3.9.9.5.3.3.1"><span class="term">Install Operator from CLI</span></dt><dd><div class="verbatim-wrap"><pre class="screen">helm repo add rancher-charts https://raw.githubusercontent.com/rancher/charts/dev-v2.7/
helm install sriov-crd rancher-charts/sriov-crd
helm install sriov rancher-charts/sriov -n kube-system</pre></div></dd><dt id="id-1.6.3.9.9.5.3.3.2"><span class="term">Install Operator from Rancher UI</span></dt><dd><p>Once your cluster is installed and you have access to the Rancher UI, you can install the SR-IOV Operator from the Rancher UI from the apps tab:</p><div class="informalfigure"><div class="mediaobject"><a href="images/features_sriov.png"><img src="images/features_sriov.png" width="NaN" alt="sriov.png" title="sriov.png"/></a></div></div></dd></dl></div></section><section class="sect4" id="id-check-the-deployed-resources-crd-and-pods" data-id-title="Check the deployed resources crd and pods"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.3 </span><span class="title-name">Check the  deployed resources crd and pods</span></span> <a title="Permalink" class="permalink" href="atip.html#id-check-the-deployed-resources-crd-and-pods">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight bash"><pre class="screen">kubectl -n sriov-network-operator get crd
kubectl -n sriov-network-operator get pods</pre></div></section><section class="sect4" id="id-check-the-label-in-the-nodes" data-id-title="Check the label in the nodes"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.4 </span><span class="title-name">Check the label in the nodes</span></span> <a title="Permalink" class="permalink" href="atip.html#id-check-the-label-in-the-nodes">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Now, if you have all resources running, the label should appears automatically in your node:</p><div class="verbatim-wrap"><pre class="screen">kubectl get nodes -oyaml | grep feature.node.kubernetes.io/network-sriov.capable
    feature.node.kubernetes.io/network-sriov.capable: "true"</pre></div><p>if not present, you can add it manually:</p><div class="verbatim-wrap highlight bash"><pre class="screen">kubectl label $(kubectl get nodes -oname) \
 feature.node.kubernetes.io/network-sriov.capable=true</pre></div></section><section class="sect4" id="id-review-the-daemonset-to-see-the-new-sriov-network-config-daemon-and-sriov-rancher-nfd-worker-as-active-and-ready" data-id-title="Review the daemonset to see the new sriov-network-config-daemon and sriov-rancher-nfd-worker as active and ready"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.5 </span><span class="title-name">Review the daemonset to see the new <code class="literal">sriov-network-config-daemon</code> and <code class="literal">sriov-rancher-nfd-worker</code> as active and ready</span></span> <a title="Permalink" class="permalink" href="atip.html#id-review-the-daemonset-to-see-the-new-sriov-network-config-daemon-and-sriov-rancher-nfd-worker-as-active-and-ready">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap"><pre class="screen">kubectl get daemonset -A
NAMESPACE             NAME                            DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                                           AGE
calico-system         calico-node                     1         1         1       1            1           kubernetes.io/os=linux                                  15h
cattle-sriov-system   sriov-network-config-daemon     1         1         1       1            1           feature.node.kubernetes.io/network-sriov.capable=true   45m
cattle-sriov-system   sriov-rancher-nfd-worker        1         1         1       1            1           &lt;none&gt;                                                  45m
kube-system           rke2-ingress-nginx-controller   1         1         1       1            1           kubernetes.io/os=linux                                  15h
kube-system           rke2-multus-ds                  1         1         1       1            1           kubernetes.io/arch=amd64,kubernetes.io/os=linux         15h</pre></div><p>After some minutes (can take up to 10 min to be updated) the nodes detected and configured will appear:</p><div class="verbatim-wrap"><pre class="screen">kubectl get sriovnetworknodestates.sriovnetwork.openshift.io -A
NAMESPACE             NAME     AGE
cattle-sriov-system   xr11-2   83s</pre></div></section><section class="sect4" id="id-check-the-interfaces-detected" data-id-title="Check the interfaces detected"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.6 </span><span class="title-name">Check the interfaces detected</span></span> <a title="Permalink" class="permalink" href="atip.html#id-check-the-interfaces-detected">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The interfaces discovered should be the pci address of the network device. Check this information with lspci command in the host.</p><div class="verbatim-wrap highlight yaml"><pre class="screen">$ kubectl get sriovnetworknodestates.sriovnetwork.openshift.io -n kube-system -oyaml
apiVersion: v1
items:
- apiVersion: sriovnetwork.openshift.io/v1
  kind: SriovNetworkNodeState
  metadata:
    creationTimestamp: "2023-06-07T09:52:37Z"
    generation: 1
    name: xr11-2
    namespace: cattle-sriov-system
    ownerReferences:
    - apiVersion: sriovnetwork.openshift.io/v1
      blockOwnerDeletion: true
      controller: true
      kind: SriovNetworkNodePolicy
      name: default
      uid: 80b72499-e26b-4072-a75c-f9a6218ec357
    resourceVersion: "356603"
    uid: e1f1654b-92b3-44d9-9f87-2571792cc1ad
  spec:
    dpConfigVersion: "356507"
  status:
    interfaces:
    - deviceID: "1592"
      driver: ice
      eSwitchMode: legacy
      linkType: ETH
      mac: 40:a6:b7:9b:35:f0
      mtu: 1500
      name: p2p1
      pciAddress: "0000:51:00.0"
      totalvfs: 128
      vendor: "8086"
    - deviceID: "1592"
      driver: ice
      eSwitchMode: legacy
      linkType: ETH
      mac: 40:a6:b7:9b:35:f1
      mtu: 1500
      name: p2p2
      pciAddress: "0000:51:00.1"
      totalvfs: 128
      vendor: "8086"
    syncStatus: Succeeded
kind: List
metadata:
  resourceVersion: ""</pre></div><div id="id-1.6.3.9.9.5.7.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>If your interface is not detected here you should ensure that it is present in the next config map</p><div class="verbatim-wrap highlight bash"><pre class="screen">kubectl get cm supported-nic-ids -oyaml -n cattle-sriov-system</pre></div><p>If your device is not there you have to edit the config map adding the right values to be discovered (should be necessary to restart the daemonset sriov-network-config-daemon)</p></div></section><section class="sect4" id="id-create-the-networknode-policy-to-configure-the-vfs" data-id-title="Create the NetworkNode Policy to configure the VFs"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.7 </span><span class="title-name">Create the NetworkNode Policy to configure the VFs</span></span> <a title="Permalink" class="permalink" href="atip.html#id-create-the-networknode-policy-to-configure-the-vfs">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Basically, you will create some VFs (<code class="literal">numVfs</code>) from the device (<code class="literal">rootDevices</code>) and will be configured with the driver (<code class="literal">deviceType</code>) and the MTU (<code class="literal">mtu</code>):</p><div class="verbatim-wrap highlight yaml"><pre class="screen">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: sriovnetwork.openshift.io/v1
kind: SriovNetworkNodePolicy
metadata:
  name: policy-dpdk
  namespace: kube-system
spec:
  nodeSelector:
    feature.node.kubernetes.io/network-sriov.capable: "true"
  resourceName: intelnicsDpdk
  deviceType: vfio-pci
  numVfs: 8
  mtu: 1500
  nicSelector:
    deviceID: "1592"
    vendor: "8086"
    rootDevices:
    - 0000:51:00.0
EOF</pre></div></section><section class="sect4" id="id-validate-configurations" data-id-title="Validate configurations"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.8 </span><span class="title-name">Validate configurations</span></span> <a title="Permalink" class="permalink" href="atip.html#id-validate-configurations">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight yaml"><pre class="screen">kubectl get $(kubectl get nodes -oname) -o jsonpath='{.status.allocatable}' | jq
{
  "cpu": "64",
  "ephemeral-storage": "256196109726",
  "hugepages-1Gi": "60Gi",
  "hugepages-2Mi": "0",
  "intel.com/intel_fec_5g": "1",
  "memory": "200424836Ki",
  "pods": "110",
  "rancher.io/intelnicsDpdk": "8"
}</pre></div></section><section class="sect4" id="id-create-the-sriov-network-optional-in-case-we-need-a-different-network" data-id-title="Create the sriov network (Optional, in case we need a different network):"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.5.2.9 </span><span class="title-name">Create the sriov network (Optional, in case we need a different network):</span></span> <a title="Permalink" class="permalink" href="atip.html#id-create-the-sriov-network-optional-in-case-we-need-a-different-network">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight yaml"><pre class="screen">cat &lt;&lt;EOF | k apply -f -
apiVersion: sriovnetwork.openshift.io/v1
kind: SriovNetwork
metadata:
  name: network-dpdk
  namespace: kube-system
spec:
  ipam: |
    {
      "type": "host-local",
      "subnet": "192.168.0.0/24",
      "rangeStart": "192.168.0.20",
      "rangeEnd": "192.168.0.60",
      "routes": [{
        "dst": "0.0.0.0/0"
      }],
      "gateway": "192.168.0.1"
    }
  vlan: 500
  resourceName: intelnicsDpdk
EOF</pre></div><p>Check the network created:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">kubectl get network-attachment-definitions.k8s.cni.cncf.io -A -oyaml

apiVersion: v1
items:
- apiVersion: k8s.cni.cncf.io/v1
  kind: NetworkAttachmentDefinition
  metadata:
    annotations:
      k8s.v1.cni.cncf.io/resourceName: rancher.io/intelnicsDpdk
    creationTimestamp: "2023-06-08T11:22:27Z"
    generation: 1
    name: network-dpdk
    namespace: kube-system
    resourceVersion: "13124"
    uid: df7c89f5-177c-4f30-ae72-7aef3294fb15
  spec:
    config: '{ "cniVersion":"0.3.1", "name":"network-dpdk","type":"sriov","vlan":500,"vlanQoS":0,"ipam":{"type":"host-local","subnet":"192.168.0.0/24","rangeStart":"192.168.0.10","rangeEnd":"192.168.0.60","routes":[{"dst":"0.0.0.0/0"}],"gateway":"192.168.0.1"}
      }'
kind: List
metadata:
  resourceVersion: ""</pre></div></section></section></section><section class="sect2" id="dpdk" data-id-title="DPDK"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.6 </span><span class="title-name">DPDK</span></span> <a title="Permalink" class="permalink" href="atip.html#dpdk">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><section class="sect3" id="id-kernel-parameters" data-id-title="Kernel parameters"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.6.1 </span><span class="title-name">Kernel parameters</span></span> <a title="Permalink" class="permalink" href="atip.html#id-kernel-parameters">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>To use dpdk using some drivers we need to enable some parameters in the kernel:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">parameter</th><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">value</th><th style="text-align: left; vertical-align: top; border-bottom: 1px solid ; ">description</th></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>iommu</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>pt</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows to use vfio for the dpdk interfaces</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>intel_iommu</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>on</p></td><td style="text-align: left; vertical-align: top; "><p>This option enables to use vfio for VFs.</p></td></tr></tbody></table></div><p>To enable this parameters we need to add them to the kernel command line:</p><div class="verbatim-wrap highlight bash"><pre class="screen">vi /etc/default/grub</pre></div><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_LINUX="intel_iommu=on intel_pstate=passive processor.max_cstate=1 intel_idle.max_cstate=0 iommu=pt usbcore.autosuspend=-1 selinux=0 enforcing=0 nmi_watchdog=0 crashkernel=auto softlockup_panic=0 audit=0 mce=off hugepagesz=1G hugepages=40 hugepagesz=2M hugepages=0 default_hugepagesz=1G kthread_cpus=0,31,32,63 irqaffinity=0,31,32,63 isolcpu=1-30,33-62 skew_tick=1 nohz_full=1-30,33-62 rcu_nocbs=1-30,33-62 rcu_nocb_poll"</pre></div><p>Then you need to update the grub configuration and reboot the system to apply the changes:</p><div class="verbatim-wrap highlight bash"><pre class="screen">transactional-update grub.cfg
reboot</pre></div><p>To validate that the parameters are applied after the reboot you can check the command line:</p><div class="verbatim-wrap highlight bash"><pre class="screen">cat /proc/cmdline</pre></div></section><section class="sect3" id="id-load-vfio-pci-kernel-module" data-id-title="Load vfio-pci kernel module"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.6.2 </span><span class="title-name">Load vfio-pci kernel module</span></span> <a title="Permalink" class="permalink" href="atip.html#id-load-vfio-pci-kernel-module">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight bash"><pre class="screen">modprobe vfio-pci</pre></div></section><section class="sect3" id="id-create-vfs-from-the-nics" data-id-title="Create VFs from the NICs"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.6.3 </span><span class="title-name">Create VFs from the NICs</span></span> <a title="Permalink" class="permalink" href="atip.html#id-create-vfs-from-the-nics">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>To create 4 VFs PCI addresses for example for 2 different NICs we need to execute the following commands:</p><div class="verbatim-wrap highlight bash"><pre class="screen">echo 4 &gt; /sys/bus/pci/devices/0000:51:00.0/sriov_numvfs
echo 4 &gt; /sys/bus/pci/devices/0000:51:00.1/sriov_numvfs</pre></div></section></section><section class="sect2" id="id-bind-the-new-vfs-with-the-vfio-pci-driver" data-id-title="Bind the new VFs with the vfio-pci driver"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.7 </span><span class="title-name">Bind the new VFs with the vfio-pci driver</span></span> <a title="Permalink" class="permalink" href="atip.html#id-bind-the-new-vfs-with-the-vfio-pci-driver">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight bash"><pre class="screen">dpdk-devbind.py -b vfio-pci 0000:51:01.0 0000:51:01.1 0000:51:01.2 \
  0000:51:01.3 0000:51:11.0 0000:51:11.1 0000:51:11.2 0000:51:11.3</pre></div></section><section class="sect2" id="id-review-the-configuration-applied" data-id-title="Review the configuration applied:"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.8 </span><span class="title-name">Review the configuration applied:</span></span> <a title="Permalink" class="permalink" href="atip.html#id-review-the-configuration-applied">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap"><pre class="screen">dpdk-devbind.py -s

Network devices using DPDK-compatible driver
============================================
0000:51:01.0 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio
0000:51:01.1 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio
0000:51:01.2 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio
0000:51:01.3 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio
0000:51:01.0 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio
0000:51:11.1 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio
0000:51:21.2 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio
0000:51:31.3 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio

Network devices using kernel driver
===================================
0000:19:00.0 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em1 drv=bnxt_en unused=igb_uio,vfio-pci *Active*
0000:19:00.1 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em2 drv=bnxt_en unused=igb_uio,vfio-pci
0000:19:00.2 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em3 drv=bnxt_en unused=igb_uio,vfio-pci
0000:19:00.3 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em4 drv=bnxt_en unused=igb_uio,vfio-pci
0000:51:00.0 'Ethernet Controller E810-C for QSFP 1592' if=eth13 drv=ice unused=igb_uio,vfio-pci
0000:51:00.1 'Ethernet Controller E810-C for QSFP 1592' if=rename8 drv=ice unused=igb_uio,vfio-pci</pre></div></section><section class="sect2" id="huge-pages" data-id-title="Huge Pages"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.9 </span><span class="title-name">Huge Pages</span></span> <a title="Permalink" class="permalink" href="atip.html#huge-pages">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>When a process uses RAM, the CPU marks it as used by that process. For efficiency, the CPU allocates RAM in chunks—​4K bytes is the default value on many platforms. Those chunks are named pages. Pages can be swapped to disk, etc.</p><p>Since the process address space is virtual, the CPU and the operating system need to remember which pages belong to which process, and where each page is stored. The more pages you have, the more time it takes to find where memory is mapped. When a process uses 1GB of memory, that’s 262144 entries to look up (1GB / 4K). If one page table entry consume 8 bytes, that’s 2MB (262144 * 8) to look up.</p><p>Most current CPU architectures support larger-than-default pages, which give the CPU/OS less entries to look-up.</p><section class="sect3" id="id-kernel-parameters-2" data-id-title="Kernel parameters"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.9.1 </span><span class="title-name">Kernel parameters</span></span> <a title="Permalink" class="permalink" href="atip.html#id-kernel-parameters-2">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>To enable the huge pages we should add the next kernel parameters:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">parameter</th><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">value</th><th style="text-align: left; vertical-align: top; border-bottom: 1px solid ; ">description</th></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>hugepagesz</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>1G</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This options allows to set the size of huge pages to 1G</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>hugepages</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>40</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This is the number of hugepages defined before</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>default_hugepagesz</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>1G</p></td><td style="text-align: left; vertical-align: top; "><p>This is the default value to get the huge pages</p></td></tr></tbody></table></div><p>Modify the grub file to add them to the kernel command line:</p><div class="verbatim-wrap highlight bash"><pre class="screen">vi /etc/default/grub</pre></div><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_LINUX="intel_iommu=on intel_pstate=passive processor.max_cstate=1 intel_idle.max_cstate=0 iommu=pt usbcore.autosuspend=-1 selinux=0 enforcing=0 nmi_watchdog=0 crashkernel=auto softlockup_panic=0 audit=0 mce=off hugepagesz=1G hugepages=40 hugepagesz=2M hugepages=0 default_hugepagesz=1G kthread_cpus=0,31,32,63 irqaffinity=0,31,32,63 isolcpu=1-30,33-62 skew_tick=1 nohz_full=1-30,33-62 rcu_nocbs=1-30,33-62 rcu_nocb_poll"</pre></div></section><section class="sect3" id="id-usage-of-huge-pages" data-id-title="Usage of huge pages"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.9.2 </span><span class="title-name">Usage of huge pages</span></span> <a title="Permalink" class="permalink" href="atip.html#id-usage-of-huge-pages">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>In order to use the huge pages we need to mount them:</p><div class="verbatim-wrap highlight bash"><pre class="screen">mkdir -p /hugepages
mount -t hugetlbfs nodev /hugepages</pre></div><p>Now you could deploy your kubernetes workload creating the resources as well as the volumes:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">...
 resources:
   requests:
     memory: "24Gi"
     hugepages-1Gi: 16Gi
     intel.com/intel_sriov_oru: '4'
   limits:
     memory: "24Gi"
     hugepages-1Gi: 16Gi
     intel.com/intel_sriov_oru: '4'
...</pre></div><div class="verbatim-wrap highlight yaml"><pre class="screen">...
volumeMounts:
  - name: hugepage
    mountPath: /hugepages
...
volumes:
  - name: hugepage
    emptyDir:
      medium: HugePages
...</pre></div></section></section><section class="sect2" id="cpu-pinning-configuration" data-id-title="CPU Pinning Configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.10 </span><span class="title-name">CPU Pinning Configuration</span></span> <a title="Permalink" class="permalink" href="atip.html#cpu-pinning-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><section class="sect3" id="id-requirements-2" data-id-title="Requirements"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.10.1 </span><span class="title-name">Requirements</span></span> <a title="Permalink" class="permalink" href="atip.html#id-requirements-2">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>You must have the CPU tuned to the performance profile covered on this section (<a class="xref" href="atip.html#cpu-tuned-configuration" title="20.5.3. CPU Tuned Configuration">Section 20.5.3, “CPU Tuned Configuration”</a>)</p></li><li class="listitem"><p>You must have the RKE2 cluster kubelet configured with the cpu management arguments covered on this <a class="link" href="./edge-site.md#cpu-management-policy" target="_blank">section</a></p></li></ul></div></section><section class="sect3" id="id-use-cpu-pinning-on-kubernetes" data-id-title="Use CPU Pinning on kubernetes"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.10.2 </span><span class="title-name">Use CPU Pinning on kubernetes</span></span> <a title="Permalink" class="permalink" href="atip.html#id-use-cpu-pinning-on-kubernetes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>There are three ways to use that feature using the <code class="literal">Static Policy</code> defined in kubelet depending on the requests and limits you define on your workload:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">BestEffort</code> QoS Class: If you don’t define any request or limit for CPU, the pod will be scheduled on the first CPU available on the system.</p><p>An example to use the <code class="literal">BestEffort</code> QoS Class could be:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">spec:
  containers:
  - name: nginx
    image: nginx</pre></div></li><li class="listitem"><p><code class="literal">Burstable</code> QoS Class: If you define a request for CPU, which is not equal to the limits, or maybe there is no CPU request.</p><p>Examples to use the <code class="literal">Burstable</code> QoS Class could be:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">spec:
  containers:
  - name: nginx
    image: nginx
    resources:
      limits:
        memory: "200Mi"
      requests:
        memory: "100Mi"</pre></div><p>or</p><div class="verbatim-wrap highlight yaml"><pre class="screen">spec:
  containers:
  - name: nginx
    image: nginx
    resources:
      limits:
        memory: "200Mi"
        cpu: "2"
      requests:
        memory: "100Mi"
        cpu: "1"</pre></div></li><li class="listitem"><p><code class="literal">Guaranteed</code> QoS Class: If you define a request for CPU, which is equal to the limits.</p><p>An example to use the <code class="literal">Guaranteed</code> QoS Class could be:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">spec:
  containers:
    - name: nginx
      image: nginx
      resources:
        limits:
          memory: "200Mi"
          cpu: "2"
        requests:
          memory: "200Mi"
          cpu: "2"</pre></div></li></ul></div></section></section><section class="sect2" id="numa-aware-scheduling" data-id-title="NUMA Aware scheduling"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.11 </span><span class="title-name">NUMA Aware scheduling</span></span> <a title="Permalink" class="permalink" href="atip.html#numa-aware-scheduling">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Non-Uniform Memory Access or Non-Uniform Memory Architecture (NUMA) is a physical memory design used in SMP (multiprocessors) architecture, where the memory access time depends on the memory location relative to a processor. Under NUMA, a processor can access its own local memory faster than non-local memory, that is, memory local to another processor or memory shared between processors.</p><section class="sect3" id="id-identify-numa-nodes" data-id-title="Identify NUMA nodes"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.11.1 </span><span class="title-name">Identify NUMA nodes</span></span> <a title="Permalink" class="permalink" href="atip.html#id-identify-numa-nodes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>To identify the NUMA nodes on your system you can use the next command:</p><div class="verbatim-wrap"><pre class="screen">numactl --hardware
available: 1 nodes (0)
node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63
node 0 size: 257167 MB
node 0 free: 246390 MB
node distances:
node   0
  0:  10</pre></div><div id="id-1.6.3.9.15.3.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>In this case we have only one NUMA node</p><p>NUMA has to enabled in the BIOS. If dmesg does not have records of numa initialization during bootup, then it is possible that NUMA related messages in the kernel ring buffer might have been overwritten.</p></div></section></section><section class="sect2" id="id-vran-acceleration-intel-acc100" data-id-title="VRAN Acceleration (Intel ACC100)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.12 </span><span class="title-name">VRAN Acceleration (Intel ACC100)</span></span> <a title="Permalink" class="permalink" href="atip.html#id-vran-acceleration-intel-acc100">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>As communications service providers move from 4G to 5G networks, many are adopting virtualized radio access network (vRAN) architectures for higher channel capacity and easier deployment of edge-based services and applications. vRAN solutions are ideally located to deliver low-latency services with the flexibility to increase or decrease capacity based on the volume of real-time traffic and demand on the network.</p><section class="sect3" id="id-kernel-parameters-3" data-id-title="Kernel parameters"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.12.1 </span><span class="title-name">Kernel parameters</span></span> <a title="Permalink" class="permalink" href="atip.html#id-kernel-parameters-3">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>To enable the vRAN acceleration we need to enable the following kernel parameters (if not present yet):</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">parameter</th><th style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; ">value</th><th style="text-align: left; vertical-align: top; border-bottom: 1px solid ; ">description</th></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>iommu</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; border-bottom: 1px solid ; "><p>pt</p></td><td style="text-align: left; vertical-align: top; border-bottom: 1px solid ; "><p>This option allows to use vfio for the dpdk interfaces</p></td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>intel_iommu</p></td><td style="text-align: left; vertical-align: top; border-right: 1px solid ; "><p>on</p></td><td style="text-align: left; vertical-align: top; "><p>This option enables to use vfio for VFs.</p></td></tr></tbody></table></div><p>Modify the grub file to add them to the kernel command line:</p><div class="verbatim-wrap highlight bash"><pre class="screen">vi /etc/default/grub</pre></div><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_LINUX="intel_iommu=on intel_pstate=passive processor.max_cstate=1 intel_idle.max_cstate=0 iommu=pt usbcore.autosuspend=-1 selinux=0 enforcing=0 nmi_watchdog=0 crashkernel=auto softlockup_panic=0 audit=0 mce=off hugepagesz=1G hugepages=40 hugepagesz=2M hugepages=0 default_hugepagesz=1G kthread_cpus=0,31,32,63 irqaffinity=0,31,32,63 isolcpu=1-30,33-62 skew_tick=1 nohz_full=1-30,33-62 rcu_nocbs=1-30,33-62 rcu_nocb_poll"</pre></div><p>Then you need to update the grub configuration and reboot the system to apply the changes:</p><div class="verbatim-wrap highlight bash"><pre class="screen">transactional-update grub.cfg
reboot</pre></div><p>To validate that the parameters are applied after the reboot you can check the command line:</p><div class="verbatim-wrap highlight bash"><pre class="screen">cat /proc/cmdline</pre></div><section class="sect4" id="id-load-igb_uio-and-vfio-pci-kernel-modules" data-id-title="Load igb_uio and vfio-pci kernel modules"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">20.5.12.1.1 </span><span class="title-name">Load igb_uio and vfio-pci kernel modules</span></span> <a title="Permalink" class="permalink" href="atip.html#id-load-igb_uio-and-vfio-pci-kernel-modules">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight bash"><pre class="screen">modprobe igb_uio
modprobe vfio-pci</pre></div></section></section><section class="sect3" id="id-get-interface-information-acc100" data-id-title="Get interface information Acc100"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.12.2 </span><span class="title-name">Get interface information Acc100</span></span> <a title="Permalink" class="permalink" href="atip.html#id-get-interface-information-acc100">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Maybe in some cases (depending on the OS) you should add to the path the /sbin/ for the lspci command doing: <code class="literal">export PATH=$PATH:/sbin/</code></p><div class="verbatim-wrap"><pre class="screen">lspci | grep -i acc
8a:00.0 Processing accelerators: Intel Corporation Device 0d5c</pre></div></section><section class="sect3" id="id-bind-the-pf-with-igb_uio-module" data-id-title="Bind the PF with igb_uio module"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.12.3 </span><span class="title-name">Bind the PF with igb_uio module</span></span> <a title="Permalink" class="permalink" href="atip.html#id-bind-the-pf-with-igb_uio-module">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap highlight bash"><pre class="screen">dpdk-devbind.py -b igb_uio 0000:8a:00.0</pre></div></section><section class="sect3" id="id-create-the-vfs-from-the-pf" data-id-title="Create the VFs from the PF"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.12.4 </span><span class="title-name">Create the VFs from the PF</span></span> <a title="Permalink" class="permalink" href="atip.html#id-create-the-vfs-from-the-pf">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>To create 2 vfs from the PF and bind with vfio-pci follow the next steps:</p><div class="verbatim-wrap"><pre class="screen">echo 2 &gt; /sys/bus/pci/devices/0000:8a:00.0/max_vfs
dpdk-devbind.py -b vfio-pci 0000:8b:00.0</pre></div></section><section class="sect3" id="id-configure-acc100-with-the-proposed-configuration-file" data-id-title="Configure acc100 with the proposed configuration file"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.12.5 </span><span class="title-name">Configure acc100 with the proposed configuration file</span></span> <a title="Permalink" class="permalink" href="atip.html#id-configure-acc100-with-the-proposed-configuration-file">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap"><pre class="screen">pf_bb_config ACC100 -c /opt/pf-bb-config/acc100_config_vf_5g.cfg
Tue Jun  6 10:49:20 2023:INFO:Queue Groups: 2 5GUL, 2 5GDL, 2 4GUL, 2 4GDL
Tue Jun  6 10:49:20 2023:INFO:Configuration in VF mode
Tue Jun  6 10:49:21 2023:INFO: ROM version MM 99AD92
Tue Jun  6 10:49:21 2023:WARN:* Note: Not on DDR PRQ version  1302020 != 10092020
Tue Jun  6 10:49:21 2023:INFO:PF ACC100 configuration complete
Tue Jun  6 10:49:21 2023:INFO:ACC100 PF [0000:8a:00.0] configuration complete!</pre></div></section><section class="sect3" id="id-check-the-new-vfs-created-from-the-fec-pf" data-id-title="Check the new VFs created from the FEC PF:"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.5.12.6 </span><span class="title-name">Check the new VFs created from the FEC PF:</span></span> <a title="Permalink" class="permalink" href="atip.html#id-check-the-new-vfs-created-from-the-fec-pf">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="verbatim-wrap"><pre class="screen">dpdk-devbind.py -s
...
...
...
Baseband devices using DPDK-compatible driver
=============================================
0000:8a:00.0 'Device 0d5c' drv=igb_uio unused=vfio-pci
0000:8b:00.0 'Device 0d5d' drv=vfio-pci unused=igb_uio

Other Baseband devices
======================
0000:8b:00.1 'Device 0d5d' unused=igb_uio,vfio-pci</pre></div></section></section></section><section class="sect1" id="metal-lb-configuration" data-id-title="Metal LB (Beta)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.6 </span><span class="title-name">Metal LB (Beta)</span></span> <a title="Permalink" class="permalink" href="atip.html#metal-lb-configuration">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>TBC</p></section><section class="sect1" id="id-lifecycle-actions" data-id-title="Lifecycle Actions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.7 </span><span class="title-name">Lifecycle Actions</span></span> <a title="Permalink" class="permalink" href="atip.html#id-lifecycle-actions">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This section covers the lifecycle management actions of deployed ATIP clusters</p><section class="sect2" id="id-software-lifecycles" data-id-title="Software lifecycles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.7.1 </span><span class="title-name">Software lifecycles</span></span> <a title="Permalink" class="permalink" href="atip.html#id-software-lifecycles">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Roadmap, support lifecycle diagram etc. Support combiantions.</p></section><section class="sect2" id="id-management-cluster-upgrades" data-id-title="Management Cluster upgrades"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.7.2 </span><span class="title-name">Management Cluster upgrades</span></span> <a title="Permalink" class="permalink" href="atip.html#id-management-cluster-upgrades">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Updating management cluster OS + RKE</p></section><section class="sect2" id="id-rancher-upgrades" data-id-title="Rancher Upgrades"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.7.3 </span><span class="title-name">Rancher Upgrades</span></span> <a title="Permalink" class="permalink" href="atip.html#id-rancher-upgrades">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Upgrading rancher versions</p></section><section class="sect2" id="id-operating-system-upgrades" data-id-title="Operating system upgrades"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.7.4 </span><span class="title-name">Operating system upgrades</span></span> <a title="Permalink" class="permalink" href="atip.html#id-operating-system-upgrades">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Upgrading OS on edge sites</p></section><section class="sect2" id="id-rke2-upgrades" data-id-title="RKE2 Upgrades"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.7.5 </span><span class="title-name">RKE2 Upgrades</span></span> <a title="Permalink" class="permalink" href="atip.html#id-rke2-upgrades">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Upgrading RKE2 on edge sites</p></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="id-product-documentation.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Part IV </span>Product Documentation</span></a> </div><div><a class="pagination-link next" href="id-appendix.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Appendix A </span>Appendix</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="section"><a href="atip.html#id-concept-architecture"><span class="title-number">20.1 </span><span class="title-name">Concept &amp; Architecture</span></a></span></li><li><span class="section"><a href="atip.html#id-requirements-assumptions"><span class="title-number">20.2 </span><span class="title-name">Requirements &amp; Assumptions</span></a></span></li><li><span class="section"><a href="atip.html#id-setting-up-the-management-cluster"><span class="title-number">20.3 </span><span class="title-name">Setting up the Management Cluster</span></a></span></li><li><span class="section"><a href="atip.html#id-edge-site-installation"><span class="title-number">20.4 </span><span class="title-name">Edge Site Installation</span></a></span></li><li><span class="section"><a href="atip.html#id-feature-configuration"><span class="title-number">20.5 </span><span class="title-name">Feature Configuration</span></a></span></li><li><span class="section"><a href="atip.html#metal-lb-configuration"><span class="title-number">20.6 </span><span class="title-name">Metal LB (Beta)</span></a></span></li><li><span class="section"><a href="atip.html#id-lifecycle-actions"><span class="title-number">20.7 </span><span class="title-name">Lifecycle Actions</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>